<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Geo Atlas Cacheï¼Œä¸€ä¸ªç²¾ç®€çš„GWCç»„ä»¶ | Fuyi Atlas</title>
<meta name="keywords" content="geo atlas cache, tile cache, gac">
<meta name="description" content="å‰è¨€ ç“¦ç‰‡ç¼“å­˜ç»„ä»¶æ˜¯ç»å¤§éƒ¨åˆ†ç“¦ç‰‡æœåŠ¡æ‰€åº”è¯¥æœ‰çš„æ¨¡å—ä¹‹ä¸€ï¼Œè€ŒGeo AtlasåŒæ ·å®ç°äº†å…¶ç“¦ç‰‡ç¼“å­˜æ¨¡å—ã€‚æœ¬æ–‡ç”¨äºæè¿°Geo Atlasä¸­çš„Cacheæ¨¡å—çš„è®¾è®¡ä¸å®ç°è¿‡ç¨‹ã€‚
ä»€ä¹ˆæ˜¯GACï¼Ÿ GACï¼Œå…¨ç§°æ˜¯Geo Atlas Cacheï¼Œæ˜¯Geo Atlasç±»åº“ä¸­çš„Cacheæ¨¡å—ï¼Œç”¨äºæä¾›çŸ¢é‡ç“¦ç‰‡çš„ç¼“å­˜åŠŸèƒ½ã€‚GACæºè‡ªGWCï¼ˆGeoWebCacheï¼‰ï¼Œæ˜¯åœ¨GWCçš„åŸºç¡€ä¸Šè¿›è¡Œäº†é€‚åº”æ€§çš„è°ƒæ•´è€Œæ¥ã€‚ç›®å‰æ”¯æŒåŸºäºå†…å­˜ã€æ–‡ä»¶ç³»ç»Ÿä¸¤ç§ç¼“å­˜æ–¹å¼ï¼Œä¸”æ­¤ä¸¤ç§ç¼“å­˜æ–¹å¼å¯ä»»æ„ç»„åˆã€‚å¯¹äºç“¦ç‰‡ç¼“å­˜å¤„ç†ç­–ç•¥ï¼Œç›®å‰æ”¯æŒSeedã€Reseedã€Truncateä¸‰ç§ï¼Œä¸GWCä¿æŒä¸€è‡´ã€‚
GACçš„åŸºæœ¬ç†å¿µ GWCä¸­å£°æ˜å¹¶å¼ºè°ƒTileLayerçš„æ¦‚å¿µï¼Œå¹¶åŸºäºæ­¤æŠ½è±¡ï¼Œç”¨ä»¥é€‚é…æ•°æ®æ¥æºä¸ç“¦ç‰‡å­˜å‚¨ï¼ˆç¼“å­˜ï¼‰ã€‚ä¹Ÿå°±å¦‚åŒGeoServerä¸­ï¼Œä¸€ä¸ªå›¾å±‚å¦‚æœéœ€è¦æ‹¥æœ‰ç¼“å­˜èƒ½åŠ›ï¼Œé‚£ä¹ˆè¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªTileLayerï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªæ‹¥æœ‰ç¼“å­˜çš„å›¾å±‚ï¼Œå°†ä¼šåŒæ—¶æŒæœ‰ä¸¤ä¸ªLayerï¼Œä¸€ä¸ªæ˜¯ Map Layerï¼ˆFeatureTypeï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯TileLayerã€‚ TileLayerä¸­è¿›è¡Œç“¦ç‰‡å­˜å‚¨ç›¸å…³å†…å®¹çš„é…ç½®ï¼Œå¯ä»¥éšæ„é…ç½®å­˜å‚¨å®¹å™¨å¯¹è±¡ï¼ˆæ–‡ä»¶ç³»ç»Ÿã€å¯¹è±¡å­˜å‚¨ã€æ•°æ®åº“ç­‰ï¼‰ã€‚
è€Œç›®å‰Geo Atlas Cacheçš„å®ç°åˆ™å°†å¤§å¤§ç®€åŒ–è¿™ä¸€æ“ä½œï¼Œæ²¡æœ‰TileLayerå¯¹è±¡ï¼Œå…¨å±€å…±ç”¨åŒä¸€ä¸ªå­˜å‚¨å®¹å™¨å¯¹è±¡ï¼Œæ— éœ€ç¹ççš„å­˜å‚¨é…ç½®ï¼Œé€šè¿‡è‡ªåŠ¨è£…é…å¿«é€Ÿå¯ç”¨ç¼“å­˜ï¼Œæˆ‘è®¤ä¸ºè¿™æ˜¯ä¸­å°é¡¹ç›®ä¸­æ‰€éœ€è¦çš„ã€‚
ç›®å‰å¯¹äºç“¦ç‰‡ç¼“å­˜ï¼ˆTile Cacheï¼‰çš„æ¸…ç†ï¼Œä¹Ÿå°±æ˜¯åŒGWCä¸­æä¾›çš„Seedã€Reseedã€Truncateä¸€èˆ¬ã€‚Truncateåªéœ€æŒæœ‰BlobStoreçš„å¥æŸ„å³å¯å®Œæˆï¼Œä½†Seedå’ŒReseedåˆ™éœ€å‰å¾€æ•°æ®çš„æºç«¯è·å–ç“¦ç‰‡ï¼Œè¿›è€Œæ‰å¯å®Œæˆæ“ä½œï¼Œä¹Ÿå°±æ˜¯éœ€è¦æŒæœ‰è·å–æºç«¯ç“¦ç‰‡Generateçš„å¥æŸ„æ‰å¯ã€‚æˆ–è®¸è¿™å°±æ˜¯ä¸ºä»€ä¹ˆGWCä¸­æå‡ºTileLayerçš„åŸå› ä¹‹ä¸€ä¹Ÿæœªå¯çŸ¥ ğŸ˜®ã€‚ ä¸è¿‡ï¼Œæˆ‘å´ç”±æ­¤è®¤ä¸ºGWCçš„è¾¹ç•Œä¸æ¸…æ™°ï¼Œæˆ‘è®¤ä¸ºç¼“å­˜å°±åšç¼“å­˜çš„äº‹æƒ…å°±å¯ä»¥äº†ï¼Œåº”å½“æŠŠLayerã€TileMatrixSetï¼ˆGridSetï¼‰å’ŒCacheåˆ†å¼€ã€‚ä½†å¦‚æ­¤ï¼Œè‹¥æƒ³è¦æ”¯æŒSeedå’ŒReseedè¿™ä¸¤ç§ç»™ç­–ç•¥çš„è¯ï¼Œè‡³å°‘éœ€è¦æä¾›ä¸€ä¸ªæ‹“å±•ç‚¹æ‰å¯ã€‚æˆ‘åœ¨æ­¤å°†å…¶å‘½åä¸ºTileSourceï¼Œæ˜¯ä¸ºCacheä¸Sourceï¼ˆæºç«¯ç“¦ç‰‡ï¼‰ä¹‹é—´çš„é€‚é…ç»„ä»¶ã€‚å…¶å®ï¼Œè¿™ä¸ä¹Ÿæ˜¯ä¸€ç§ç­‰åŒTileLayerçš„å­˜åœ¨ï¼Œä½†æˆ‘å¹¶ä¸é€šè¿‡Layeræ¥è¿›è¡Œå…³è”æ§åˆ¶ï¼Œä¹Ÿæ²¡æœ‰TileLayerçš„æ¦‚å¿µï¼Œç¼“å­˜å°±æ˜¯ç¼“å­˜ã€‚
GACçš„è®¾è®¡ä¸å®ç° å› ä¸ºGeoServeræ²‰é‡çš„å†å²åŒ…è¢±ä»¥åŠå¤§è€Œå…¨çš„è‡ƒè‚¿ï¼Œæ‰€ä»¥æœ‰äº†Geo Atlasé¡¹ç›®ã€‚GACä¹Ÿå°†å»¶ç»­æ­¤ç†å¿µï¼Œå»é™¤Cacheç‰¹å®šäºLayerçš„æ¦‚å¿µï¼Œæ— éœ€ä¸ºå›¾å±‚å•ç‹¬é…ç½®ç¼“å­˜ï¼Œå› ä¸ºç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ä½¿ç”¨ç›¸åŒçš„ç¼“å­˜é…ç½®ã€‚åŒæ—¶ï¼Œä»–åº”è¯¥æ˜¯å¯ä»¥è¢«å¿«é€Ÿé›†æˆï¼Œä¸”æ˜“äºé…ç½®çš„ã€‚ä¸ºäº†æå‡ç¼“å­˜ç»„ä»¶çš„æ˜“ç”¨æ€§ã€å…¼å®¹æ€§åŠç¨³å®šæ€§ï¼Œè‡³å°‘åº”è¯¥æä¾›ä¸¤ç§ä¸åŒçš„ç¼“å­˜å­˜å‚¨å¯¹è±¡ï¼Œä¸”å…¶ä¸­ä¸€ç§åº”è¯¥æ˜¯åŸºäºå†…å­˜çš„ï¼Œå¦å¤–ä¸€ç§æ˜¯æ”¯æŒæŒä¹…åŒ–çš„ã€‚å½“æ•°æ®é‡å¾ˆå°‘æ—¶ï¼Œå¯ä»¥å…³é—­ç¼“å­˜æˆ–ä»…å¼€å¯å†…å­˜ç¼“å­˜ï¼›å½“æ•°æ®é‡è¾ƒå¤§æ—¶ï¼Œå¯ä»¥ä»…å¼€å¯æŒä¹…åŒ–ç¼“å­˜æˆ–åŒæ—¶å¼€å¯å†…å­˜ç¼“å­˜ã€‚å†…å­˜ç¼“å­˜ä¸å¯æŒä¹…åŒ–ç¼“å­˜å¯è‡ªç”±æ­é…ï¼Œä»»æ„ç»„åˆã€‚å½“ä¸¤è€…å…¨å¼€å¯æ—¶ï¼Œå¯å½¢æˆä¸¤çº§ç¼“å­˜ï¼Œæ­¤æ—¶éœ€æ³¨æ„ä¸¤çº§ç¼“å­˜é—´æ•°æ®çš„åŒæ­¥ã€‚
GACçš„éœ€æ±‚ä¸è®¾è®¡ æ¥ä¸‹æ¥ï¼Œå†æ¬¡ç¡®å®šä¸€ä¸‹GACçš„éœ€æ±‚ï¼š
æ”¯æŒçŸ¢é‡ç“¦ç‰‡ç¼“å­˜ æä¾›ä¸¤ç±»ç¼“å­˜å­˜å‚¨å¯¹è±¡ï¼Œå…¶ä¸­ä¸€ç§åº”è¯¥æ˜¯åŸºäºå†…å­˜çš„ï¼Œå¦å¤–ä¸€ç§æ˜¯æ”¯æŒæŒä¹…åŒ–çš„ï¼Œä¸”ä¸¤è€…å¯ä»»æ„ç»„åˆï¼ŒåŒæ—¶å¼€å¯å¯å½¢æˆäºŒçº§ç¼“å­˜ç»“æ„ æä¾›Seedã€Reseedã€Truncateæ­¤ä¸‰ç§ç“¦ç‰‡ç¼“å­˜æ¸…ç†ç­–ç•¥ å…¨å±€å…±ç”¨åŒä¸€ä¸ªç¼“å­˜å­˜å‚¨å¯¹è±¡ï¼Œæä¾›å¿«é€Ÿé›†æˆèƒ½åŠ› å…¶ä¸­ï¼ŒäºŒçº§ç¼“å­˜æ˜¯æ­¤å‰æ²¡æœ‰æ¥è§¦è¿‡çš„å†…å®¹ã€‚ç»“åˆè‡ªæˆ‘è‡†æƒ³ï¼Œç»™å‡ºäº†å¦‚ä¸‹è®¾æƒ³ ğŸ«£ï¼š
æ­¤äºŒçº§ç¼“å­˜ï¼Œå¯è‡ªè¡Œç¡®å®šç»„åˆæ–¹å¼ï¼Œå¹¶ééœ€è¦ä¸¤è€…åŒæ—¶å¼€å¯ã€‚éš¾ç‚¹ï¼šçŠ¶æ€åŒæ­¥ï¼ˆæ•°æ®ä¸€è‡´æ€§ï¼‰
ä¸€çº§ç¼“å­˜ï¼ˆåŸºäºå†…å­˜ï¼‰ï¼š Local Mem Cache &#43; LRU Guava Caffeine äºŒçº§ç¼“å­˜ï¼ˆå¯æŒä¹…åŒ–ï¼‰ï¼šOuter Cache Redis File System Database GeoPackage æ¯ä¸€ä¸ªLevelä¸€ä¸ªgpkgæ–‡ä»¶ï¼Œæå‡å¹¶å‘è¯»å†™èƒ½åŠ›ï¼ˆæ”¯æŒé…ç½®ä¸ºæ‰€æœ‰Levelç”¨ä¸€ä¸ªgpkgï¼Œä½†æ˜¯ä¸æ¨èï¼‰ PostGIS ä¸è¿‡ï¼Œåœ¨ç»è¿‡ä¸€ç•ªè°ƒç ”ä¹‹åï¼Œè¿˜æ˜¯å†³å®šæŠ„GeoWebCacheçš„ä½œä¸š ğŸ˜§ã€‚ä¸€æ˜¯ç¡®å®æœ‰ä¸€å®šçš„éš¾åº¦ï¼ŒäºŒæ˜¯ç›®å‰æ—¶é—´æœ‰é™ï¼ŒGAPä¸­çš„æˆ‘æ—©å·²ç‘Ÿç‘Ÿå‘æŠ– ğŸ™„ã€‚æœ€é‡è¦çš„æ˜¯ï¼ŒGeoWebCacheä¸­çš„MemoryBlobStoreå·²ç»å®ç°äº†ä¸Šè¿°äºŒçº§ç¼“å­˜çš„éœ€æ±‚å‘€ ğŸ«¡ï¼Œå¦‚æ­¤æ“ä½œå¯ç›´æ¥è¦†ç›–æ‰å‰ä¸‰ä¸ªéœ€æ±‚ã€‚è€Œæ­¤æ—¶äºŒçº§ç¼“å­˜çš„å®ç°ç¡®å®šä¸ºï¼š
åŸºäºå†…å­˜çš„ç¼“å­˜ï¼ˆGuavaï¼‰ åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„ç¼“å­˜ éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œæ­¤MemoryBlobStoreäºŒçº§ç¼“å­˜æ˜¯å¯æ‹“å±•æ¶æ„ï¼Œåç»­å¯è‡ªè¡Œæ‹“å±•ä¸åŒçš„Providerã€‚
ğŸ’¡ å¯¹äºSeedä¸Reseedçš„å¤„ç†ï¼Œåˆ™ä¸GACçš„ç†å¿µä¸­æ‰€è¿°ä¸€è‡´ï¼Œé€šè¿‡TileSourceå¯¹å¤–æä¾›æ‹“å±•ã€‚ä¹Ÿå°±æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼ŒCacheæ¨¡å—åªæä¾›Seedä¸Reseedçš„å£°æ˜ï¼Œæ— æ³•æä¾›å…·ä½“å®ç°ï¼ˆæ— æ³•ç›´æ¥ä¸Sourceè¿›è¡Œé“¾æ¥ï¼‰ã€‚
é‚£ä¹ˆæ­¤åˆ»åªå‰©ä¸‹æœ€åä¸€ä¸ªéœ€æ±‚äº†ï¼Œå…¶ä¸»æ—¨å›´ç»•å¿«é€Ÿé…ç½®ã€æ˜“ç”¨ã€‚åœ¨æ­¤åŸºäºGeoWebCacheä¸­çš„DefaultStorageBroker ç±»è¿›è¡Œç¼“å­˜å­˜å‚¨å¯¹è±¡çš„ä»£ç†ï¼Œå…¶ç¬¦åˆGWCä¸­ç¼“å­˜å­˜å‚¨å¯¹è±¡è®¾è®¡æ¶æ„ï¼Œä¹Ÿä¸ºåç»­æä¾›äº†æ›´å¤šçš„æ‹“å±•ç‚¹ï¼ŒåŒæ—¶å°†å…¶æš´éœ²ç»™å…¨å±€ï¼Œå³å…¨å±€å…±ç”¨çš„ç¼“å­˜å­˜å‚¨å¯¹è±¡ã€‚å¯¹äºå¿«é€Ÿé›†æˆèƒ½åŠ›ï¼Œæ­¤å¤„å°†ç»“åˆSpring Bootçš„AutoConfigurationç‰¹æ€§ï¼Œä¸ºGACæä¾›è‡ªåŠ¨è£…é…èƒ½åŠ›ã€‚ä¸æ­¤åŒæ—¶ï¼Œå°†ç¼“å­˜å­˜å‚¨å¯¹è±¡çš„å¯è®¾ç½®å±æ€§é€šè¿‡é…ç½®çš„æ–¹å¼æš´éœ²å‡ºæ¥ï¼Œå¯ç›´æ¥åœ¨application.ymlæˆ–application.propertiesä¸­è¿›è¡Œé…ç½®ã€‚å…·ä½“å¯é…ç½®å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š
geo-atlas.cache.enabled=falseï¼ˆæ˜¯å¦å¯ç”¨ç¼“å­˜ï¼Œé»˜è®¤ä¸ºfalseï¼‰ geo-atlas.cache.inner-caching-enabled=falseï¼ˆæ˜¯å¦å¯ç”¨å†…å­˜ç¼“å­˜ï¼Œé»˜è®¤ä¸ºfalseï¼‰
geo-atlas.cache.inner.storage.provider=guavaï¼ˆå¯é€‰å€¼ï¼šguavaï¼Œæš‚ä¸æ”¯æŒï¼Œä¿ç•™ï¼‰
geo-atlas.cache.inner.storage.memory-limit=16ï¼ˆå†…å­˜å¤§å°é™åˆ¶ï¼Œå•ä½MBï¼Œé»˜è®¤16ï¼‰
geo-atlas.cache.inner.storage.concurrency-level=4ï¼ˆç¼“å­˜å¹¶å‘çº§åˆ«çš„é»˜è®¤å€¼ï¼Œé»˜è®¤ä¸º4ï¼‰
geo-atlas.cache.inner.storage.eviction-policy=nullï¼ˆç¼“å­˜é©±é€æ”¿ç­–ï¼Œå³ç¼“å­˜æ·˜æ±°ç®—æ³•ï¼Œå¯é€‰å€¼ï¼šNULLã€LRUã€LFUã€EXPIRE_AFTER_WRITEã€EXPIRE_AFTER_ACCESSï¼Œé»˜è®¤å€¼ä¸ºNULLï¼‰
ğŸ’¡ LRUã€LFUæš‚æ—¶ä¸æ”¯æŒ">
<meta name="author" content="Fuyi">
<link rel="canonical" href="https://fuyi-atlas.github.io/posts/gis/what-is-gac/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.a61ecc0df414536d559b3d0ca421e2b1de8f39b8a4910b32fedccecbc2c0d59c.css" integrity="sha256-ph7MDfQUU21Vmz0MpCHisd6PObikkQsy/tzOy8LA1Zw=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://fuyi-atlas.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://fuyi-atlas.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://fuyi-atlas.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://fuyi-atlas.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://fuyi-atlas.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://fuyi-atlas.github.io/posts/gis/what-is-gac/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Geo Atlas Cacheï¼Œä¸€ä¸ªç²¾ç®€çš„GWCç»„ä»¶" />
<meta property="og:description" content="å‰è¨€ ç“¦ç‰‡ç¼“å­˜ç»„ä»¶æ˜¯ç»å¤§éƒ¨åˆ†ç“¦ç‰‡æœåŠ¡æ‰€åº”è¯¥æœ‰çš„æ¨¡å—ä¹‹ä¸€ï¼Œè€ŒGeo AtlasåŒæ ·å®ç°äº†å…¶ç“¦ç‰‡ç¼“å­˜æ¨¡å—ã€‚æœ¬æ–‡ç”¨äºæè¿°Geo Atlasä¸­çš„Cacheæ¨¡å—çš„è®¾è®¡ä¸å®ç°è¿‡ç¨‹ã€‚
ä»€ä¹ˆæ˜¯GACï¼Ÿ GACï¼Œå…¨ç§°æ˜¯Geo Atlas Cacheï¼Œæ˜¯Geo Atlasç±»åº“ä¸­çš„Cacheæ¨¡å—ï¼Œç”¨äºæä¾›çŸ¢é‡ç“¦ç‰‡çš„ç¼“å­˜åŠŸèƒ½ã€‚GACæºè‡ªGWCï¼ˆGeoWebCacheï¼‰ï¼Œæ˜¯åœ¨GWCçš„åŸºç¡€ä¸Šè¿›è¡Œäº†é€‚åº”æ€§çš„è°ƒæ•´è€Œæ¥ã€‚ç›®å‰æ”¯æŒåŸºäºå†…å­˜ã€æ–‡ä»¶ç³»ç»Ÿä¸¤ç§ç¼“å­˜æ–¹å¼ï¼Œä¸”æ­¤ä¸¤ç§ç¼“å­˜æ–¹å¼å¯ä»»æ„ç»„åˆã€‚å¯¹äºç“¦ç‰‡ç¼“å­˜å¤„ç†ç­–ç•¥ï¼Œç›®å‰æ”¯æŒSeedã€Reseedã€Truncateä¸‰ç§ï¼Œä¸GWCä¿æŒä¸€è‡´ã€‚
GACçš„åŸºæœ¬ç†å¿µ GWCä¸­å£°æ˜å¹¶å¼ºè°ƒTileLayerçš„æ¦‚å¿µï¼Œå¹¶åŸºäºæ­¤æŠ½è±¡ï¼Œç”¨ä»¥é€‚é…æ•°æ®æ¥æºä¸ç“¦ç‰‡å­˜å‚¨ï¼ˆç¼“å­˜ï¼‰ã€‚ä¹Ÿå°±å¦‚åŒGeoServerä¸­ï¼Œä¸€ä¸ªå›¾å±‚å¦‚æœéœ€è¦æ‹¥æœ‰ç¼“å­˜èƒ½åŠ›ï¼Œé‚£ä¹ˆè¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªTileLayerï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªæ‹¥æœ‰ç¼“å­˜çš„å›¾å±‚ï¼Œå°†ä¼šåŒæ—¶æŒæœ‰ä¸¤ä¸ªLayerï¼Œä¸€ä¸ªæ˜¯ Map Layerï¼ˆFeatureTypeï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯TileLayerã€‚ TileLayerä¸­è¿›è¡Œç“¦ç‰‡å­˜å‚¨ç›¸å…³å†…å®¹çš„é…ç½®ï¼Œå¯ä»¥éšæ„é…ç½®å­˜å‚¨å®¹å™¨å¯¹è±¡ï¼ˆæ–‡ä»¶ç³»ç»Ÿã€å¯¹è±¡å­˜å‚¨ã€æ•°æ®åº“ç­‰ï¼‰ã€‚
è€Œç›®å‰Geo Atlas Cacheçš„å®ç°åˆ™å°†å¤§å¤§ç®€åŒ–è¿™ä¸€æ“ä½œï¼Œæ²¡æœ‰TileLayerå¯¹è±¡ï¼Œå…¨å±€å…±ç”¨åŒä¸€ä¸ªå­˜å‚¨å®¹å™¨å¯¹è±¡ï¼Œæ— éœ€ç¹ççš„å­˜å‚¨é…ç½®ï¼Œé€šè¿‡è‡ªåŠ¨è£…é…å¿«é€Ÿå¯ç”¨ç¼“å­˜ï¼Œæˆ‘è®¤ä¸ºè¿™æ˜¯ä¸­å°é¡¹ç›®ä¸­æ‰€éœ€è¦çš„ã€‚
ç›®å‰å¯¹äºç“¦ç‰‡ç¼“å­˜ï¼ˆTile Cacheï¼‰çš„æ¸…ç†ï¼Œä¹Ÿå°±æ˜¯åŒGWCä¸­æä¾›çš„Seedã€Reseedã€Truncateä¸€èˆ¬ã€‚Truncateåªéœ€æŒæœ‰BlobStoreçš„å¥æŸ„å³å¯å®Œæˆï¼Œä½†Seedå’ŒReseedåˆ™éœ€å‰å¾€æ•°æ®çš„æºç«¯è·å–ç“¦ç‰‡ï¼Œè¿›è€Œæ‰å¯å®Œæˆæ“ä½œï¼Œä¹Ÿå°±æ˜¯éœ€è¦æŒæœ‰è·å–æºç«¯ç“¦ç‰‡Generateçš„å¥æŸ„æ‰å¯ã€‚æˆ–è®¸è¿™å°±æ˜¯ä¸ºä»€ä¹ˆGWCä¸­æå‡ºTileLayerçš„åŸå› ä¹‹ä¸€ä¹Ÿæœªå¯çŸ¥ ğŸ˜®ã€‚ ä¸è¿‡ï¼Œæˆ‘å´ç”±æ­¤è®¤ä¸ºGWCçš„è¾¹ç•Œä¸æ¸…æ™°ï¼Œæˆ‘è®¤ä¸ºç¼“å­˜å°±åšç¼“å­˜çš„äº‹æƒ…å°±å¯ä»¥äº†ï¼Œåº”å½“æŠŠLayerã€TileMatrixSetï¼ˆGridSetï¼‰å’ŒCacheåˆ†å¼€ã€‚ä½†å¦‚æ­¤ï¼Œè‹¥æƒ³è¦æ”¯æŒSeedå’ŒReseedè¿™ä¸¤ç§ç»™ç­–ç•¥çš„è¯ï¼Œè‡³å°‘éœ€è¦æä¾›ä¸€ä¸ªæ‹“å±•ç‚¹æ‰å¯ã€‚æˆ‘åœ¨æ­¤å°†å…¶å‘½åä¸ºTileSourceï¼Œæ˜¯ä¸ºCacheä¸Sourceï¼ˆæºç«¯ç“¦ç‰‡ï¼‰ä¹‹é—´çš„é€‚é…ç»„ä»¶ã€‚å…¶å®ï¼Œè¿™ä¸ä¹Ÿæ˜¯ä¸€ç§ç­‰åŒTileLayerçš„å­˜åœ¨ï¼Œä½†æˆ‘å¹¶ä¸é€šè¿‡Layeræ¥è¿›è¡Œå…³è”æ§åˆ¶ï¼Œä¹Ÿæ²¡æœ‰TileLayerçš„æ¦‚å¿µï¼Œç¼“å­˜å°±æ˜¯ç¼“å­˜ã€‚
GACçš„è®¾è®¡ä¸å®ç° å› ä¸ºGeoServeræ²‰é‡çš„å†å²åŒ…è¢±ä»¥åŠå¤§è€Œå…¨çš„è‡ƒè‚¿ï¼Œæ‰€ä»¥æœ‰äº†Geo Atlasé¡¹ç›®ã€‚GACä¹Ÿå°†å»¶ç»­æ­¤ç†å¿µï¼Œå»é™¤Cacheç‰¹å®šäºLayerçš„æ¦‚å¿µï¼Œæ— éœ€ä¸ºå›¾å±‚å•ç‹¬é…ç½®ç¼“å­˜ï¼Œå› ä¸ºç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ä½¿ç”¨ç›¸åŒçš„ç¼“å­˜é…ç½®ã€‚åŒæ—¶ï¼Œä»–åº”è¯¥æ˜¯å¯ä»¥è¢«å¿«é€Ÿé›†æˆï¼Œä¸”æ˜“äºé…ç½®çš„ã€‚ä¸ºäº†æå‡ç¼“å­˜ç»„ä»¶çš„æ˜“ç”¨æ€§ã€å…¼å®¹æ€§åŠç¨³å®šæ€§ï¼Œè‡³å°‘åº”è¯¥æä¾›ä¸¤ç§ä¸åŒçš„ç¼“å­˜å­˜å‚¨å¯¹è±¡ï¼Œä¸”å…¶ä¸­ä¸€ç§åº”è¯¥æ˜¯åŸºäºå†…å­˜çš„ï¼Œå¦å¤–ä¸€ç§æ˜¯æ”¯æŒæŒä¹…åŒ–çš„ã€‚å½“æ•°æ®é‡å¾ˆå°‘æ—¶ï¼Œå¯ä»¥å…³é—­ç¼“å­˜æˆ–ä»…å¼€å¯å†…å­˜ç¼“å­˜ï¼›å½“æ•°æ®é‡è¾ƒå¤§æ—¶ï¼Œå¯ä»¥ä»…å¼€å¯æŒä¹…åŒ–ç¼“å­˜æˆ–åŒæ—¶å¼€å¯å†…å­˜ç¼“å­˜ã€‚å†…å­˜ç¼“å­˜ä¸å¯æŒä¹…åŒ–ç¼“å­˜å¯è‡ªç”±æ­é…ï¼Œä»»æ„ç»„åˆã€‚å½“ä¸¤è€…å…¨å¼€å¯æ—¶ï¼Œå¯å½¢æˆä¸¤çº§ç¼“å­˜ï¼Œæ­¤æ—¶éœ€æ³¨æ„ä¸¤çº§ç¼“å­˜é—´æ•°æ®çš„åŒæ­¥ã€‚
GACçš„éœ€æ±‚ä¸è®¾è®¡ æ¥ä¸‹æ¥ï¼Œå†æ¬¡ç¡®å®šä¸€ä¸‹GACçš„éœ€æ±‚ï¼š
æ”¯æŒçŸ¢é‡ç“¦ç‰‡ç¼“å­˜ æä¾›ä¸¤ç±»ç¼“å­˜å­˜å‚¨å¯¹è±¡ï¼Œå…¶ä¸­ä¸€ç§åº”è¯¥æ˜¯åŸºäºå†…å­˜çš„ï¼Œå¦å¤–ä¸€ç§æ˜¯æ”¯æŒæŒä¹…åŒ–çš„ï¼Œä¸”ä¸¤è€…å¯ä»»æ„ç»„åˆï¼ŒåŒæ—¶å¼€å¯å¯å½¢æˆäºŒçº§ç¼“å­˜ç»“æ„ æä¾›Seedã€Reseedã€Truncateæ­¤ä¸‰ç§ç“¦ç‰‡ç¼“å­˜æ¸…ç†ç­–ç•¥ å…¨å±€å…±ç”¨åŒä¸€ä¸ªç¼“å­˜å­˜å‚¨å¯¹è±¡ï¼Œæä¾›å¿«é€Ÿé›†æˆèƒ½åŠ› å…¶ä¸­ï¼ŒäºŒçº§ç¼“å­˜æ˜¯æ­¤å‰æ²¡æœ‰æ¥è§¦è¿‡çš„å†…å®¹ã€‚ç»“åˆè‡ªæˆ‘è‡†æƒ³ï¼Œç»™å‡ºäº†å¦‚ä¸‹è®¾æƒ³ ğŸ«£ï¼š
æ­¤äºŒçº§ç¼“å­˜ï¼Œå¯è‡ªè¡Œç¡®å®šç»„åˆæ–¹å¼ï¼Œå¹¶ééœ€è¦ä¸¤è€…åŒæ—¶å¼€å¯ã€‚éš¾ç‚¹ï¼šçŠ¶æ€åŒæ­¥ï¼ˆæ•°æ®ä¸€è‡´æ€§ï¼‰
ä¸€çº§ç¼“å­˜ï¼ˆåŸºäºå†…å­˜ï¼‰ï¼š Local Mem Cache &#43; LRU Guava Caffeine äºŒçº§ç¼“å­˜ï¼ˆå¯æŒä¹…åŒ–ï¼‰ï¼šOuter Cache Redis File System Database GeoPackage æ¯ä¸€ä¸ªLevelä¸€ä¸ªgpkgæ–‡ä»¶ï¼Œæå‡å¹¶å‘è¯»å†™èƒ½åŠ›ï¼ˆæ”¯æŒé…ç½®ä¸ºæ‰€æœ‰Levelç”¨ä¸€ä¸ªgpkgï¼Œä½†æ˜¯ä¸æ¨èï¼‰ PostGIS ä¸è¿‡ï¼Œåœ¨ç»è¿‡ä¸€ç•ªè°ƒç ”ä¹‹åï¼Œè¿˜æ˜¯å†³å®šæŠ„GeoWebCacheçš„ä½œä¸š ğŸ˜§ã€‚ä¸€æ˜¯ç¡®å®æœ‰ä¸€å®šçš„éš¾åº¦ï¼ŒäºŒæ˜¯ç›®å‰æ—¶é—´æœ‰é™ï¼ŒGAPä¸­çš„æˆ‘æ—©å·²ç‘Ÿç‘Ÿå‘æŠ– ğŸ™„ã€‚æœ€é‡è¦çš„æ˜¯ï¼ŒGeoWebCacheä¸­çš„MemoryBlobStoreå·²ç»å®ç°äº†ä¸Šè¿°äºŒçº§ç¼“å­˜çš„éœ€æ±‚å‘€ ğŸ«¡ï¼Œå¦‚æ­¤æ“ä½œå¯ç›´æ¥è¦†ç›–æ‰å‰ä¸‰ä¸ªéœ€æ±‚ã€‚è€Œæ­¤æ—¶äºŒçº§ç¼“å­˜çš„å®ç°ç¡®å®šä¸ºï¼š
åŸºäºå†…å­˜çš„ç¼“å­˜ï¼ˆGuavaï¼‰ åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„ç¼“å­˜ éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œæ­¤MemoryBlobStoreäºŒçº§ç¼“å­˜æ˜¯å¯æ‹“å±•æ¶æ„ï¼Œåç»­å¯è‡ªè¡Œæ‹“å±•ä¸åŒçš„Providerã€‚
ğŸ’¡ å¯¹äºSeedä¸Reseedçš„å¤„ç†ï¼Œåˆ™ä¸GACçš„ç†å¿µä¸­æ‰€è¿°ä¸€è‡´ï¼Œé€šè¿‡TileSourceå¯¹å¤–æä¾›æ‹“å±•ã€‚ä¹Ÿå°±æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼ŒCacheæ¨¡å—åªæä¾›Seedä¸Reseedçš„å£°æ˜ï¼Œæ— æ³•æä¾›å…·ä½“å®ç°ï¼ˆæ— æ³•ç›´æ¥ä¸Sourceè¿›è¡Œé“¾æ¥ï¼‰ã€‚
é‚£ä¹ˆæ­¤åˆ»åªå‰©ä¸‹æœ€åä¸€ä¸ªéœ€æ±‚äº†ï¼Œå…¶ä¸»æ—¨å›´ç»•å¿«é€Ÿé…ç½®ã€æ˜“ç”¨ã€‚åœ¨æ­¤åŸºäºGeoWebCacheä¸­çš„DefaultStorageBroker ç±»è¿›è¡Œç¼“å­˜å­˜å‚¨å¯¹è±¡çš„ä»£ç†ï¼Œå…¶ç¬¦åˆGWCä¸­ç¼“å­˜å­˜å‚¨å¯¹è±¡è®¾è®¡æ¶æ„ï¼Œä¹Ÿä¸ºåç»­æä¾›äº†æ›´å¤šçš„æ‹“å±•ç‚¹ï¼ŒåŒæ—¶å°†å…¶æš´éœ²ç»™å…¨å±€ï¼Œå³å…¨å±€å…±ç”¨çš„ç¼“å­˜å­˜å‚¨å¯¹è±¡ã€‚å¯¹äºå¿«é€Ÿé›†æˆèƒ½åŠ›ï¼Œæ­¤å¤„å°†ç»“åˆSpring Bootçš„AutoConfigurationç‰¹æ€§ï¼Œä¸ºGACæä¾›è‡ªåŠ¨è£…é…èƒ½åŠ›ã€‚ä¸æ­¤åŒæ—¶ï¼Œå°†ç¼“å­˜å­˜å‚¨å¯¹è±¡çš„å¯è®¾ç½®å±æ€§é€šè¿‡é…ç½®çš„æ–¹å¼æš´éœ²å‡ºæ¥ï¼Œå¯ç›´æ¥åœ¨application.ymlæˆ–application.propertiesä¸­è¿›è¡Œé…ç½®ã€‚å…·ä½“å¯é…ç½®å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š
geo-atlas.cache.enabled=falseï¼ˆæ˜¯å¦å¯ç”¨ç¼“å­˜ï¼Œé»˜è®¤ä¸ºfalseï¼‰ geo-atlas.cache.inner-caching-enabled=falseï¼ˆæ˜¯å¦å¯ç”¨å†…å­˜ç¼“å­˜ï¼Œé»˜è®¤ä¸ºfalseï¼‰
geo-atlas.cache.inner.storage.provider=guavaï¼ˆå¯é€‰å€¼ï¼šguavaï¼Œæš‚ä¸æ”¯æŒï¼Œä¿ç•™ï¼‰
geo-atlas.cache.inner.storage.memory-limit=16ï¼ˆå†…å­˜å¤§å°é™åˆ¶ï¼Œå•ä½MBï¼Œé»˜è®¤16ï¼‰
geo-atlas.cache.inner.storage.concurrency-level=4ï¼ˆç¼“å­˜å¹¶å‘çº§åˆ«çš„é»˜è®¤å€¼ï¼Œé»˜è®¤ä¸º4ï¼‰
geo-atlas.cache.inner.storage.eviction-policy=nullï¼ˆç¼“å­˜é©±é€æ”¿ç­–ï¼Œå³ç¼“å­˜æ·˜æ±°ç®—æ³•ï¼Œå¯é€‰å€¼ï¼šNULLã€LRUã€LFUã€EXPIRE_AFTER_WRITEã€EXPIRE_AFTER_ACCESSï¼Œé»˜è®¤å€¼ä¸ºNULLï¼‰
ğŸ’¡ LRUã€LFUæš‚æ—¶ä¸æ”¯æŒ" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://fuyi-atlas.github.io/posts/gis/what-is-gac/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-07-13T15:23:18+08:00" />
<meta property="article:modified_time" content="2024-07-13T15:23:18+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Geo Atlas Cacheï¼Œä¸€ä¸ªç²¾ç®€çš„GWCç»„ä»¶"/>
<meta name="twitter:description" content="å‰è¨€ ç“¦ç‰‡ç¼“å­˜ç»„ä»¶æ˜¯ç»å¤§éƒ¨åˆ†ç“¦ç‰‡æœåŠ¡æ‰€åº”è¯¥æœ‰çš„æ¨¡å—ä¹‹ä¸€ï¼Œè€ŒGeo AtlasåŒæ ·å®ç°äº†å…¶ç“¦ç‰‡ç¼“å­˜æ¨¡å—ã€‚æœ¬æ–‡ç”¨äºæè¿°Geo Atlasä¸­çš„Cacheæ¨¡å—çš„è®¾è®¡ä¸å®ç°è¿‡ç¨‹ã€‚
ä»€ä¹ˆæ˜¯GACï¼Ÿ GACï¼Œå…¨ç§°æ˜¯Geo Atlas Cacheï¼Œæ˜¯Geo Atlasç±»åº“ä¸­çš„Cacheæ¨¡å—ï¼Œç”¨äºæä¾›çŸ¢é‡ç“¦ç‰‡çš„ç¼“å­˜åŠŸèƒ½ã€‚GACæºè‡ªGWCï¼ˆGeoWebCacheï¼‰ï¼Œæ˜¯åœ¨GWCçš„åŸºç¡€ä¸Šè¿›è¡Œäº†é€‚åº”æ€§çš„è°ƒæ•´è€Œæ¥ã€‚ç›®å‰æ”¯æŒåŸºäºå†…å­˜ã€æ–‡ä»¶ç³»ç»Ÿä¸¤ç§ç¼“å­˜æ–¹å¼ï¼Œä¸”æ­¤ä¸¤ç§ç¼“å­˜æ–¹å¼å¯ä»»æ„ç»„åˆã€‚å¯¹äºç“¦ç‰‡ç¼“å­˜å¤„ç†ç­–ç•¥ï¼Œç›®å‰æ”¯æŒSeedã€Reseedã€Truncateä¸‰ç§ï¼Œä¸GWCä¿æŒä¸€è‡´ã€‚
GACçš„åŸºæœ¬ç†å¿µ GWCä¸­å£°æ˜å¹¶å¼ºè°ƒTileLayerçš„æ¦‚å¿µï¼Œå¹¶åŸºäºæ­¤æŠ½è±¡ï¼Œç”¨ä»¥é€‚é…æ•°æ®æ¥æºä¸ç“¦ç‰‡å­˜å‚¨ï¼ˆç¼“å­˜ï¼‰ã€‚ä¹Ÿå°±å¦‚åŒGeoServerä¸­ï¼Œä¸€ä¸ªå›¾å±‚å¦‚æœéœ€è¦æ‹¥æœ‰ç¼“å­˜èƒ½åŠ›ï¼Œé‚£ä¹ˆè¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªTileLayerï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªæ‹¥æœ‰ç¼“å­˜çš„å›¾å±‚ï¼Œå°†ä¼šåŒæ—¶æŒæœ‰ä¸¤ä¸ªLayerï¼Œä¸€ä¸ªæ˜¯ Map Layerï¼ˆFeatureTypeï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯TileLayerã€‚ TileLayerä¸­è¿›è¡Œç“¦ç‰‡å­˜å‚¨ç›¸å…³å†…å®¹çš„é…ç½®ï¼Œå¯ä»¥éšæ„é…ç½®å­˜å‚¨å®¹å™¨å¯¹è±¡ï¼ˆæ–‡ä»¶ç³»ç»Ÿã€å¯¹è±¡å­˜å‚¨ã€æ•°æ®åº“ç­‰ï¼‰ã€‚
è€Œç›®å‰Geo Atlas Cacheçš„å®ç°åˆ™å°†å¤§å¤§ç®€åŒ–è¿™ä¸€æ“ä½œï¼Œæ²¡æœ‰TileLayerå¯¹è±¡ï¼Œå…¨å±€å…±ç”¨åŒä¸€ä¸ªå­˜å‚¨å®¹å™¨å¯¹è±¡ï¼Œæ— éœ€ç¹ççš„å­˜å‚¨é…ç½®ï¼Œé€šè¿‡è‡ªåŠ¨è£…é…å¿«é€Ÿå¯ç”¨ç¼“å­˜ï¼Œæˆ‘è®¤ä¸ºè¿™æ˜¯ä¸­å°é¡¹ç›®ä¸­æ‰€éœ€è¦çš„ã€‚
ç›®å‰å¯¹äºç“¦ç‰‡ç¼“å­˜ï¼ˆTile Cacheï¼‰çš„æ¸…ç†ï¼Œä¹Ÿå°±æ˜¯åŒGWCä¸­æä¾›çš„Seedã€Reseedã€Truncateä¸€èˆ¬ã€‚Truncateåªéœ€æŒæœ‰BlobStoreçš„å¥æŸ„å³å¯å®Œæˆï¼Œä½†Seedå’ŒReseedåˆ™éœ€å‰å¾€æ•°æ®çš„æºç«¯è·å–ç“¦ç‰‡ï¼Œè¿›è€Œæ‰å¯å®Œæˆæ“ä½œï¼Œä¹Ÿå°±æ˜¯éœ€è¦æŒæœ‰è·å–æºç«¯ç“¦ç‰‡Generateçš„å¥æŸ„æ‰å¯ã€‚æˆ–è®¸è¿™å°±æ˜¯ä¸ºä»€ä¹ˆGWCä¸­æå‡ºTileLayerçš„åŸå› ä¹‹ä¸€ä¹Ÿæœªå¯çŸ¥ ğŸ˜®ã€‚ ä¸è¿‡ï¼Œæˆ‘å´ç”±æ­¤è®¤ä¸ºGWCçš„è¾¹ç•Œä¸æ¸…æ™°ï¼Œæˆ‘è®¤ä¸ºç¼“å­˜å°±åšç¼“å­˜çš„äº‹æƒ…å°±å¯ä»¥äº†ï¼Œåº”å½“æŠŠLayerã€TileMatrixSetï¼ˆGridSetï¼‰å’ŒCacheåˆ†å¼€ã€‚ä½†å¦‚æ­¤ï¼Œè‹¥æƒ³è¦æ”¯æŒSeedå’ŒReseedè¿™ä¸¤ç§ç»™ç­–ç•¥çš„è¯ï¼Œè‡³å°‘éœ€è¦æä¾›ä¸€ä¸ªæ‹“å±•ç‚¹æ‰å¯ã€‚æˆ‘åœ¨æ­¤å°†å…¶å‘½åä¸ºTileSourceï¼Œæ˜¯ä¸ºCacheä¸Sourceï¼ˆæºç«¯ç“¦ç‰‡ï¼‰ä¹‹é—´çš„é€‚é…ç»„ä»¶ã€‚å…¶å®ï¼Œè¿™ä¸ä¹Ÿæ˜¯ä¸€ç§ç­‰åŒTileLayerçš„å­˜åœ¨ï¼Œä½†æˆ‘å¹¶ä¸é€šè¿‡Layeræ¥è¿›è¡Œå…³è”æ§åˆ¶ï¼Œä¹Ÿæ²¡æœ‰TileLayerçš„æ¦‚å¿µï¼Œç¼“å­˜å°±æ˜¯ç¼“å­˜ã€‚
GACçš„è®¾è®¡ä¸å®ç° å› ä¸ºGeoServeræ²‰é‡çš„å†å²åŒ…è¢±ä»¥åŠå¤§è€Œå…¨çš„è‡ƒè‚¿ï¼Œæ‰€ä»¥æœ‰äº†Geo Atlasé¡¹ç›®ã€‚GACä¹Ÿå°†å»¶ç»­æ­¤ç†å¿µï¼Œå»é™¤Cacheç‰¹å®šäºLayerçš„æ¦‚å¿µï¼Œæ— éœ€ä¸ºå›¾å±‚å•ç‹¬é…ç½®ç¼“å­˜ï¼Œå› ä¸ºç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ä½¿ç”¨ç›¸åŒçš„ç¼“å­˜é…ç½®ã€‚åŒæ—¶ï¼Œä»–åº”è¯¥æ˜¯å¯ä»¥è¢«å¿«é€Ÿé›†æˆï¼Œä¸”æ˜“äºé…ç½®çš„ã€‚ä¸ºäº†æå‡ç¼“å­˜ç»„ä»¶çš„æ˜“ç”¨æ€§ã€å…¼å®¹æ€§åŠç¨³å®šæ€§ï¼Œè‡³å°‘åº”è¯¥æä¾›ä¸¤ç§ä¸åŒçš„ç¼“å­˜å­˜å‚¨å¯¹è±¡ï¼Œä¸”å…¶ä¸­ä¸€ç§åº”è¯¥æ˜¯åŸºäºå†…å­˜çš„ï¼Œå¦å¤–ä¸€ç§æ˜¯æ”¯æŒæŒä¹…åŒ–çš„ã€‚å½“æ•°æ®é‡å¾ˆå°‘æ—¶ï¼Œå¯ä»¥å…³é—­ç¼“å­˜æˆ–ä»…å¼€å¯å†…å­˜ç¼“å­˜ï¼›å½“æ•°æ®é‡è¾ƒå¤§æ—¶ï¼Œå¯ä»¥ä»…å¼€å¯æŒä¹…åŒ–ç¼“å­˜æˆ–åŒæ—¶å¼€å¯å†…å­˜ç¼“å­˜ã€‚å†…å­˜ç¼“å­˜ä¸å¯æŒä¹…åŒ–ç¼“å­˜å¯è‡ªç”±æ­é…ï¼Œä»»æ„ç»„åˆã€‚å½“ä¸¤è€…å…¨å¼€å¯æ—¶ï¼Œå¯å½¢æˆä¸¤çº§ç¼“å­˜ï¼Œæ­¤æ—¶éœ€æ³¨æ„ä¸¤çº§ç¼“å­˜é—´æ•°æ®çš„åŒæ­¥ã€‚
GACçš„éœ€æ±‚ä¸è®¾è®¡ æ¥ä¸‹æ¥ï¼Œå†æ¬¡ç¡®å®šä¸€ä¸‹GACçš„éœ€æ±‚ï¼š
æ”¯æŒçŸ¢é‡ç“¦ç‰‡ç¼“å­˜ æä¾›ä¸¤ç±»ç¼“å­˜å­˜å‚¨å¯¹è±¡ï¼Œå…¶ä¸­ä¸€ç§åº”è¯¥æ˜¯åŸºäºå†…å­˜çš„ï¼Œå¦å¤–ä¸€ç§æ˜¯æ”¯æŒæŒä¹…åŒ–çš„ï¼Œä¸”ä¸¤è€…å¯ä»»æ„ç»„åˆï¼ŒåŒæ—¶å¼€å¯å¯å½¢æˆäºŒçº§ç¼“å­˜ç»“æ„ æä¾›Seedã€Reseedã€Truncateæ­¤ä¸‰ç§ç“¦ç‰‡ç¼“å­˜æ¸…ç†ç­–ç•¥ å…¨å±€å…±ç”¨åŒä¸€ä¸ªç¼“å­˜å­˜å‚¨å¯¹è±¡ï¼Œæä¾›å¿«é€Ÿé›†æˆèƒ½åŠ› å…¶ä¸­ï¼ŒäºŒçº§ç¼“å­˜æ˜¯æ­¤å‰æ²¡æœ‰æ¥è§¦è¿‡çš„å†…å®¹ã€‚ç»“åˆè‡ªæˆ‘è‡†æƒ³ï¼Œç»™å‡ºäº†å¦‚ä¸‹è®¾æƒ³ ğŸ«£ï¼š
æ­¤äºŒçº§ç¼“å­˜ï¼Œå¯è‡ªè¡Œç¡®å®šç»„åˆæ–¹å¼ï¼Œå¹¶ééœ€è¦ä¸¤è€…åŒæ—¶å¼€å¯ã€‚éš¾ç‚¹ï¼šçŠ¶æ€åŒæ­¥ï¼ˆæ•°æ®ä¸€è‡´æ€§ï¼‰
ä¸€çº§ç¼“å­˜ï¼ˆåŸºäºå†…å­˜ï¼‰ï¼š Local Mem Cache &#43; LRU Guava Caffeine äºŒçº§ç¼“å­˜ï¼ˆå¯æŒä¹…åŒ–ï¼‰ï¼šOuter Cache Redis File System Database GeoPackage æ¯ä¸€ä¸ªLevelä¸€ä¸ªgpkgæ–‡ä»¶ï¼Œæå‡å¹¶å‘è¯»å†™èƒ½åŠ›ï¼ˆæ”¯æŒé…ç½®ä¸ºæ‰€æœ‰Levelç”¨ä¸€ä¸ªgpkgï¼Œä½†æ˜¯ä¸æ¨èï¼‰ PostGIS ä¸è¿‡ï¼Œåœ¨ç»è¿‡ä¸€ç•ªè°ƒç ”ä¹‹åï¼Œè¿˜æ˜¯å†³å®šæŠ„GeoWebCacheçš„ä½œä¸š ğŸ˜§ã€‚ä¸€æ˜¯ç¡®å®æœ‰ä¸€å®šçš„éš¾åº¦ï¼ŒäºŒæ˜¯ç›®å‰æ—¶é—´æœ‰é™ï¼ŒGAPä¸­çš„æˆ‘æ—©å·²ç‘Ÿç‘Ÿå‘æŠ– ğŸ™„ã€‚æœ€é‡è¦çš„æ˜¯ï¼ŒGeoWebCacheä¸­çš„MemoryBlobStoreå·²ç»å®ç°äº†ä¸Šè¿°äºŒçº§ç¼“å­˜çš„éœ€æ±‚å‘€ ğŸ«¡ï¼Œå¦‚æ­¤æ“ä½œå¯ç›´æ¥è¦†ç›–æ‰å‰ä¸‰ä¸ªéœ€æ±‚ã€‚è€Œæ­¤æ—¶äºŒçº§ç¼“å­˜çš„å®ç°ç¡®å®šä¸ºï¼š
åŸºäºå†…å­˜çš„ç¼“å­˜ï¼ˆGuavaï¼‰ åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„ç¼“å­˜ éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œæ­¤MemoryBlobStoreäºŒçº§ç¼“å­˜æ˜¯å¯æ‹“å±•æ¶æ„ï¼Œåç»­å¯è‡ªè¡Œæ‹“å±•ä¸åŒçš„Providerã€‚
ğŸ’¡ å¯¹äºSeedä¸Reseedçš„å¤„ç†ï¼Œåˆ™ä¸GACçš„ç†å¿µä¸­æ‰€è¿°ä¸€è‡´ï¼Œé€šè¿‡TileSourceå¯¹å¤–æä¾›æ‹“å±•ã€‚ä¹Ÿå°±æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼ŒCacheæ¨¡å—åªæä¾›Seedä¸Reseedçš„å£°æ˜ï¼Œæ— æ³•æä¾›å…·ä½“å®ç°ï¼ˆæ— æ³•ç›´æ¥ä¸Sourceè¿›è¡Œé“¾æ¥ï¼‰ã€‚
é‚£ä¹ˆæ­¤åˆ»åªå‰©ä¸‹æœ€åä¸€ä¸ªéœ€æ±‚äº†ï¼Œå…¶ä¸»æ—¨å›´ç»•å¿«é€Ÿé…ç½®ã€æ˜“ç”¨ã€‚åœ¨æ­¤åŸºäºGeoWebCacheä¸­çš„DefaultStorageBroker ç±»è¿›è¡Œç¼“å­˜å­˜å‚¨å¯¹è±¡çš„ä»£ç†ï¼Œå…¶ç¬¦åˆGWCä¸­ç¼“å­˜å­˜å‚¨å¯¹è±¡è®¾è®¡æ¶æ„ï¼Œä¹Ÿä¸ºåç»­æä¾›äº†æ›´å¤šçš„æ‹“å±•ç‚¹ï¼ŒåŒæ—¶å°†å…¶æš´éœ²ç»™å…¨å±€ï¼Œå³å…¨å±€å…±ç”¨çš„ç¼“å­˜å­˜å‚¨å¯¹è±¡ã€‚å¯¹äºå¿«é€Ÿé›†æˆèƒ½åŠ›ï¼Œæ­¤å¤„å°†ç»“åˆSpring Bootçš„AutoConfigurationç‰¹æ€§ï¼Œä¸ºGACæä¾›è‡ªåŠ¨è£…é…èƒ½åŠ›ã€‚ä¸æ­¤åŒæ—¶ï¼Œå°†ç¼“å­˜å­˜å‚¨å¯¹è±¡çš„å¯è®¾ç½®å±æ€§é€šè¿‡é…ç½®çš„æ–¹å¼æš´éœ²å‡ºæ¥ï¼Œå¯ç›´æ¥åœ¨application.ymlæˆ–application.propertiesä¸­è¿›è¡Œé…ç½®ã€‚å…·ä½“å¯é…ç½®å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š
geo-atlas.cache.enabled=falseï¼ˆæ˜¯å¦å¯ç”¨ç¼“å­˜ï¼Œé»˜è®¤ä¸ºfalseï¼‰ geo-atlas.cache.inner-caching-enabled=falseï¼ˆæ˜¯å¦å¯ç”¨å†…å­˜ç¼“å­˜ï¼Œé»˜è®¤ä¸ºfalseï¼‰
geo-atlas.cache.inner.storage.provider=guavaï¼ˆå¯é€‰å€¼ï¼šguavaï¼Œæš‚ä¸æ”¯æŒï¼Œä¿ç•™ï¼‰
geo-atlas.cache.inner.storage.memory-limit=16ï¼ˆå†…å­˜å¤§å°é™åˆ¶ï¼Œå•ä½MBï¼Œé»˜è®¤16ï¼‰
geo-atlas.cache.inner.storage.concurrency-level=4ï¼ˆç¼“å­˜å¹¶å‘çº§åˆ«çš„é»˜è®¤å€¼ï¼Œé»˜è®¤ä¸º4ï¼‰
geo-atlas.cache.inner.storage.eviction-policy=nullï¼ˆç¼“å­˜é©±é€æ”¿ç­–ï¼Œå³ç¼“å­˜æ·˜æ±°ç®—æ³•ï¼Œå¯é€‰å€¼ï¼šNULLã€LRUã€LFUã€EXPIRE_AFTER_WRITEã€EXPIRE_AFTER_ACCESSï¼Œé»˜è®¤å€¼ä¸ºNULLï¼‰
ğŸ’¡ LRUã€LFUæš‚æ—¶ä¸æ”¯æŒ"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://fuyi-atlas.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Geo Atlas Cacheï¼Œä¸€ä¸ªç²¾ç®€çš„GWCç»„ä»¶",
      "item": "https://fuyi-atlas.github.io/posts/gis/what-is-gac/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Geo Atlas Cacheï¼Œä¸€ä¸ªç²¾ç®€çš„GWCç»„ä»¶",
  "name": "Geo Atlas Cacheï¼Œä¸€ä¸ªç²¾ç®€çš„GWCç»„ä»¶",
  "description": "å‰è¨€ ç“¦ç‰‡ç¼“å­˜ç»„ä»¶æ˜¯ç»å¤§éƒ¨åˆ†ç“¦ç‰‡æœåŠ¡æ‰€åº”è¯¥æœ‰çš„æ¨¡å—ä¹‹ä¸€ï¼Œè€ŒGeo AtlasåŒæ ·å®ç°äº†å…¶ç“¦ç‰‡ç¼“å­˜æ¨¡å—ã€‚æœ¬æ–‡ç”¨äºæè¿°Geo Atlasä¸­çš„Cacheæ¨¡å—çš„è®¾è®¡ä¸å®ç°è¿‡ç¨‹ã€‚\nä»€ä¹ˆæ˜¯GACï¼Ÿ GACï¼Œå…¨ç§°æ˜¯Geo Atlas Cacheï¼Œæ˜¯Geo Atlasç±»åº“ä¸­çš„Cacheæ¨¡å—ï¼Œç”¨äºæä¾›çŸ¢é‡ç“¦ç‰‡çš„ç¼“å­˜åŠŸèƒ½ã€‚GACæºè‡ªGWCï¼ˆGeoWebCacheï¼‰ï¼Œæ˜¯åœ¨GWCçš„åŸºç¡€ä¸Šè¿›è¡Œäº†é€‚åº”æ€§çš„è°ƒæ•´è€Œæ¥ã€‚ç›®å‰æ”¯æŒåŸºäºå†…å­˜ã€æ–‡ä»¶ç³»ç»Ÿä¸¤ç§ç¼“å­˜æ–¹å¼ï¼Œä¸”æ­¤ä¸¤ç§ç¼“å­˜æ–¹å¼å¯ä»»æ„ç»„åˆã€‚å¯¹äºç“¦ç‰‡ç¼“å­˜å¤„ç†ç­–ç•¥ï¼Œç›®å‰æ”¯æŒSeedã€Reseedã€Truncateä¸‰ç§ï¼Œä¸GWCä¿æŒä¸€è‡´ã€‚\nGACçš„åŸºæœ¬ç†å¿µ GWCä¸­å£°æ˜å¹¶å¼ºè°ƒTileLayerçš„æ¦‚å¿µï¼Œå¹¶åŸºäºæ­¤æŠ½è±¡ï¼Œç”¨ä»¥é€‚é…æ•°æ®æ¥æºä¸ç“¦ç‰‡å­˜å‚¨ï¼ˆç¼“å­˜ï¼‰ã€‚ä¹Ÿå°±å¦‚åŒGeoServerä¸­ï¼Œä¸€ä¸ªå›¾å±‚å¦‚æœéœ€è¦æ‹¥æœ‰ç¼“å­˜èƒ½åŠ›ï¼Œé‚£ä¹ˆè¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªTileLayerï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªæ‹¥æœ‰ç¼“å­˜çš„å›¾å±‚ï¼Œå°†ä¼šåŒæ—¶æŒæœ‰ä¸¤ä¸ªLayerï¼Œä¸€ä¸ªæ˜¯ Map Layerï¼ˆFeatureTypeï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯TileLayerã€‚ TileLayerä¸­è¿›è¡Œç“¦ç‰‡å­˜å‚¨ç›¸å…³å†…å®¹çš„é…ç½®ï¼Œå¯ä»¥éšæ„é…ç½®å­˜å‚¨å®¹å™¨å¯¹è±¡ï¼ˆæ–‡ä»¶ç³»ç»Ÿã€å¯¹è±¡å­˜å‚¨ã€æ•°æ®åº“ç­‰ï¼‰ã€‚\nè€Œç›®å‰Geo Atlas Cacheçš„å®ç°åˆ™å°†å¤§å¤§ç®€åŒ–è¿™ä¸€æ“ä½œï¼Œæ²¡æœ‰TileLayerå¯¹è±¡ï¼Œå…¨å±€å…±ç”¨åŒä¸€ä¸ªå­˜å‚¨å®¹å™¨å¯¹è±¡ï¼Œæ— éœ€ç¹ççš„å­˜å‚¨é…ç½®ï¼Œé€šè¿‡è‡ªåŠ¨è£…é…å¿«é€Ÿå¯ç”¨ç¼“å­˜ï¼Œæˆ‘è®¤ä¸ºè¿™æ˜¯ä¸­å°é¡¹ç›®ä¸­æ‰€éœ€è¦çš„ã€‚\nç›®å‰å¯¹äºç“¦ç‰‡ç¼“å­˜ï¼ˆTile Cacheï¼‰çš„æ¸…ç†ï¼Œä¹Ÿå°±æ˜¯åŒGWCä¸­æä¾›çš„Seedã€Reseedã€Truncateä¸€èˆ¬ã€‚Truncateåªéœ€æŒæœ‰BlobStoreçš„å¥æŸ„å³å¯å®Œæˆï¼Œä½†Seedå’ŒReseedåˆ™éœ€å‰å¾€æ•°æ®çš„æºç«¯è·å–ç“¦ç‰‡ï¼Œè¿›è€Œæ‰å¯å®Œæˆæ“ä½œï¼Œä¹Ÿå°±æ˜¯éœ€è¦æŒæœ‰è·å–æºç«¯ç“¦ç‰‡Generateçš„å¥æŸ„æ‰å¯ã€‚æˆ–è®¸è¿™å°±æ˜¯ä¸ºä»€ä¹ˆGWCä¸­æå‡ºTileLayerçš„åŸå› ä¹‹ä¸€ä¹Ÿæœªå¯çŸ¥ ğŸ˜®ã€‚ ä¸è¿‡ï¼Œæˆ‘å´ç”±æ­¤è®¤ä¸ºGWCçš„è¾¹ç•Œä¸æ¸…æ™°ï¼Œæˆ‘è®¤ä¸ºç¼“å­˜å°±åšç¼“å­˜çš„äº‹æƒ…å°±å¯ä»¥äº†ï¼Œåº”å½“æŠŠLayerã€TileMatrixSetï¼ˆGridSetï¼‰å’ŒCacheåˆ†å¼€ã€‚ä½†å¦‚æ­¤ï¼Œè‹¥æƒ³è¦æ”¯æŒSeedå’ŒReseedè¿™ä¸¤ç§ç»™ç­–ç•¥çš„è¯ï¼Œè‡³å°‘éœ€è¦æä¾›ä¸€ä¸ªæ‹“å±•ç‚¹æ‰å¯ã€‚æˆ‘åœ¨æ­¤å°†å…¶å‘½åä¸ºTileSourceï¼Œæ˜¯ä¸ºCacheä¸Sourceï¼ˆæºç«¯ç“¦ç‰‡ï¼‰ä¹‹é—´çš„é€‚é…ç»„ä»¶ã€‚å…¶å®ï¼Œè¿™ä¸ä¹Ÿæ˜¯ä¸€ç§ç­‰åŒTileLayerçš„å­˜åœ¨ï¼Œä½†æˆ‘å¹¶ä¸é€šè¿‡Layeræ¥è¿›è¡Œå…³è”æ§åˆ¶ï¼Œä¹Ÿæ²¡æœ‰TileLayerçš„æ¦‚å¿µï¼Œç¼“å­˜å°±æ˜¯ç¼“å­˜ã€‚\nGACçš„è®¾è®¡ä¸å®ç° å› ä¸ºGeoServeræ²‰é‡çš„å†å²åŒ…è¢±ä»¥åŠå¤§è€Œå…¨çš„è‡ƒè‚¿ï¼Œæ‰€ä»¥æœ‰äº†Geo Atlasé¡¹ç›®ã€‚GACä¹Ÿå°†å»¶ç»­æ­¤ç†å¿µï¼Œå»é™¤Cacheç‰¹å®šäºLayerçš„æ¦‚å¿µï¼Œæ— éœ€ä¸ºå›¾å±‚å•ç‹¬é…ç½®ç¼“å­˜ï¼Œå› ä¸ºç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ä½¿ç”¨ç›¸åŒçš„ç¼“å­˜é…ç½®ã€‚åŒæ—¶ï¼Œä»–åº”è¯¥æ˜¯å¯ä»¥è¢«å¿«é€Ÿé›†æˆï¼Œä¸”æ˜“äºé…ç½®çš„ã€‚ä¸ºäº†æå‡ç¼“å­˜ç»„ä»¶çš„æ˜“ç”¨æ€§ã€å…¼å®¹æ€§åŠç¨³å®šæ€§ï¼Œè‡³å°‘åº”è¯¥æä¾›ä¸¤ç§ä¸åŒçš„ç¼“å­˜å­˜å‚¨å¯¹è±¡ï¼Œä¸”å…¶ä¸­ä¸€ç§åº”è¯¥æ˜¯åŸºäºå†…å­˜çš„ï¼Œå¦å¤–ä¸€ç§æ˜¯æ”¯æŒæŒä¹…åŒ–çš„ã€‚å½“æ•°æ®é‡å¾ˆå°‘æ—¶ï¼Œå¯ä»¥å…³é—­ç¼“å­˜æˆ–ä»…å¼€å¯å†…å­˜ç¼“å­˜ï¼›å½“æ•°æ®é‡è¾ƒå¤§æ—¶ï¼Œå¯ä»¥ä»…å¼€å¯æŒä¹…åŒ–ç¼“å­˜æˆ–åŒæ—¶å¼€å¯å†…å­˜ç¼“å­˜ã€‚å†…å­˜ç¼“å­˜ä¸å¯æŒä¹…åŒ–ç¼“å­˜å¯è‡ªç”±æ­é…ï¼Œä»»æ„ç»„åˆã€‚å½“ä¸¤è€…å…¨å¼€å¯æ—¶ï¼Œå¯å½¢æˆä¸¤çº§ç¼“å­˜ï¼Œæ­¤æ—¶éœ€æ³¨æ„ä¸¤çº§ç¼“å­˜é—´æ•°æ®çš„åŒæ­¥ã€‚\nGACçš„éœ€æ±‚ä¸è®¾è®¡ æ¥ä¸‹æ¥ï¼Œå†æ¬¡ç¡®å®šä¸€ä¸‹GACçš„éœ€æ±‚ï¼š\næ”¯æŒçŸ¢é‡ç“¦ç‰‡ç¼“å­˜ æä¾›ä¸¤ç±»ç¼“å­˜å­˜å‚¨å¯¹è±¡ï¼Œå…¶ä¸­ä¸€ç§åº”è¯¥æ˜¯åŸºäºå†…å­˜çš„ï¼Œå¦å¤–ä¸€ç§æ˜¯æ”¯æŒæŒä¹…åŒ–çš„ï¼Œä¸”ä¸¤è€…å¯ä»»æ„ç»„åˆï¼ŒåŒæ—¶å¼€å¯å¯å½¢æˆäºŒçº§ç¼“å­˜ç»“æ„ æä¾›Seedã€Reseedã€Truncateæ­¤ä¸‰ç§ç“¦ç‰‡ç¼“å­˜æ¸…ç†ç­–ç•¥ å…¨å±€å…±ç”¨åŒä¸€ä¸ªç¼“å­˜å­˜å‚¨å¯¹è±¡ï¼Œæä¾›å¿«é€Ÿé›†æˆèƒ½åŠ› å…¶ä¸­ï¼ŒäºŒçº§ç¼“å­˜æ˜¯æ­¤å‰æ²¡æœ‰æ¥è§¦è¿‡çš„å†…å®¹ã€‚ç»“åˆè‡ªæˆ‘è‡†æƒ³ï¼Œç»™å‡ºäº†å¦‚ä¸‹è®¾æƒ³ ğŸ«£ï¼š\næ­¤äºŒçº§ç¼“å­˜ï¼Œå¯è‡ªè¡Œç¡®å®šç»„åˆæ–¹å¼ï¼Œå¹¶ééœ€è¦ä¸¤è€…åŒæ—¶å¼€å¯ã€‚éš¾ç‚¹ï¼šçŠ¶æ€åŒæ­¥ï¼ˆæ•°æ®ä¸€è‡´æ€§ï¼‰\nä¸€çº§ç¼“å­˜ï¼ˆåŸºäºå†…å­˜ï¼‰ï¼š Local Mem Cache + LRU Guava Caffeine äºŒçº§ç¼“å­˜ï¼ˆå¯æŒä¹…åŒ–ï¼‰ï¼šOuter Cache Redis File System Database GeoPackage æ¯ä¸€ä¸ªLevelä¸€ä¸ªgpkgæ–‡ä»¶ï¼Œæå‡å¹¶å‘è¯»å†™èƒ½åŠ›ï¼ˆæ”¯æŒé…ç½®ä¸ºæ‰€æœ‰Levelç”¨ä¸€ä¸ªgpkgï¼Œä½†æ˜¯ä¸æ¨èï¼‰ PostGIS ä¸è¿‡ï¼Œåœ¨ç»è¿‡ä¸€ç•ªè°ƒç ”ä¹‹åï¼Œè¿˜æ˜¯å†³å®šæŠ„GeoWebCacheçš„ä½œä¸š ğŸ˜§ã€‚ä¸€æ˜¯ç¡®å®æœ‰ä¸€å®šçš„éš¾åº¦ï¼ŒäºŒæ˜¯ç›®å‰æ—¶é—´æœ‰é™ï¼ŒGAPä¸­çš„æˆ‘æ—©å·²ç‘Ÿç‘Ÿå‘æŠ– ğŸ™„ã€‚æœ€é‡è¦çš„æ˜¯ï¼ŒGeoWebCacheä¸­çš„MemoryBlobStoreå·²ç»å®ç°äº†ä¸Šè¿°äºŒçº§ç¼“å­˜çš„éœ€æ±‚å‘€ ğŸ«¡ï¼Œå¦‚æ­¤æ“ä½œå¯ç›´æ¥è¦†ç›–æ‰å‰ä¸‰ä¸ªéœ€æ±‚ã€‚è€Œæ­¤æ—¶äºŒçº§ç¼“å­˜çš„å®ç°ç¡®å®šä¸ºï¼š\nåŸºäºå†…å­˜çš„ç¼“å­˜ï¼ˆGuavaï¼‰ åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„ç¼“å­˜ éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œæ­¤MemoryBlobStoreäºŒçº§ç¼“å­˜æ˜¯å¯æ‹“å±•æ¶æ„ï¼Œåç»­å¯è‡ªè¡Œæ‹“å±•ä¸åŒçš„Providerã€‚\nğŸ’¡ å¯¹äºSeedä¸Reseedçš„å¤„ç†ï¼Œåˆ™ä¸GACçš„ç†å¿µä¸­æ‰€è¿°ä¸€è‡´ï¼Œé€šè¿‡TileSourceå¯¹å¤–æä¾›æ‹“å±•ã€‚ä¹Ÿå°±æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼ŒCacheæ¨¡å—åªæä¾›Seedä¸Reseedçš„å£°æ˜ï¼Œæ— æ³•æä¾›å…·ä½“å®ç°ï¼ˆæ— æ³•ç›´æ¥ä¸Sourceè¿›è¡Œé“¾æ¥ï¼‰ã€‚\né‚£ä¹ˆæ­¤åˆ»åªå‰©ä¸‹æœ€åä¸€ä¸ªéœ€æ±‚äº†ï¼Œå…¶ä¸»æ—¨å›´ç»•å¿«é€Ÿé…ç½®ã€æ˜“ç”¨ã€‚åœ¨æ­¤åŸºäºGeoWebCacheä¸­çš„DefaultStorageBroker ç±»è¿›è¡Œç¼“å­˜å­˜å‚¨å¯¹è±¡çš„ä»£ç†ï¼Œå…¶ç¬¦åˆGWCä¸­ç¼“å­˜å­˜å‚¨å¯¹è±¡è®¾è®¡æ¶æ„ï¼Œä¹Ÿä¸ºåç»­æä¾›äº†æ›´å¤šçš„æ‹“å±•ç‚¹ï¼ŒåŒæ—¶å°†å…¶æš´éœ²ç»™å…¨å±€ï¼Œå³å…¨å±€å…±ç”¨çš„ç¼“å­˜å­˜å‚¨å¯¹è±¡ã€‚å¯¹äºå¿«é€Ÿé›†æˆèƒ½åŠ›ï¼Œæ­¤å¤„å°†ç»“åˆSpring Bootçš„AutoConfigurationç‰¹æ€§ï¼Œä¸ºGACæä¾›è‡ªåŠ¨è£…é…èƒ½åŠ›ã€‚ä¸æ­¤åŒæ—¶ï¼Œå°†ç¼“å­˜å­˜å‚¨å¯¹è±¡çš„å¯è®¾ç½®å±æ€§é€šè¿‡é…ç½®çš„æ–¹å¼æš´éœ²å‡ºæ¥ï¼Œå¯ç›´æ¥åœ¨application.ymlæˆ–application.propertiesä¸­è¿›è¡Œé…ç½®ã€‚å…·ä½“å¯é…ç½®å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š\ngeo-atlas.cache.enabled=falseï¼ˆæ˜¯å¦å¯ç”¨ç¼“å­˜ï¼Œé»˜è®¤ä¸ºfalseï¼‰ geo-atlas.cache.inner-caching-enabled=falseï¼ˆæ˜¯å¦å¯ç”¨å†…å­˜ç¼“å­˜ï¼Œé»˜è®¤ä¸ºfalseï¼‰\ngeo-atlas.cache.inner.storage.provider=guavaï¼ˆå¯é€‰å€¼ï¼šguavaï¼Œæš‚ä¸æ”¯æŒï¼Œä¿ç•™ï¼‰\ngeo-atlas.cache.inner.storage.memory-limit=16ï¼ˆå†…å­˜å¤§å°é™åˆ¶ï¼Œå•ä½MBï¼Œé»˜è®¤16ï¼‰\ngeo-atlas.cache.inner.storage.concurrency-level=4ï¼ˆç¼“å­˜å¹¶å‘çº§åˆ«çš„é»˜è®¤å€¼ï¼Œé»˜è®¤ä¸º4ï¼‰\ngeo-atlas.cache.inner.storage.eviction-policy=nullï¼ˆç¼“å­˜é©±é€æ”¿ç­–ï¼Œå³ç¼“å­˜æ·˜æ±°ç®—æ³•ï¼Œå¯é€‰å€¼ï¼šNULLã€LRUã€LFUã€EXPIRE_AFTER_WRITEã€EXPIRE_AFTER_ACCESSï¼Œé»˜è®¤å€¼ä¸ºNULLï¼‰\nğŸ’¡ LRUã€LFUæš‚æ—¶ä¸æ”¯æŒ",
  "keywords": [
    "geo atlas cache", "tile cache", "gac"
  ],
  "articleBody": "å‰è¨€ ç“¦ç‰‡ç¼“å­˜ç»„ä»¶æ˜¯ç»å¤§éƒ¨åˆ†ç“¦ç‰‡æœåŠ¡æ‰€åº”è¯¥æœ‰çš„æ¨¡å—ä¹‹ä¸€ï¼Œè€ŒGeo AtlasåŒæ ·å®ç°äº†å…¶ç“¦ç‰‡ç¼“å­˜æ¨¡å—ã€‚æœ¬æ–‡ç”¨äºæè¿°Geo Atlasä¸­çš„Cacheæ¨¡å—çš„è®¾è®¡ä¸å®ç°è¿‡ç¨‹ã€‚\nä»€ä¹ˆæ˜¯GACï¼Ÿ GACï¼Œå…¨ç§°æ˜¯Geo Atlas Cacheï¼Œæ˜¯Geo Atlasç±»åº“ä¸­çš„Cacheæ¨¡å—ï¼Œç”¨äºæä¾›çŸ¢é‡ç“¦ç‰‡çš„ç¼“å­˜åŠŸèƒ½ã€‚GACæºè‡ªGWCï¼ˆGeoWebCacheï¼‰ï¼Œæ˜¯åœ¨GWCçš„åŸºç¡€ä¸Šè¿›è¡Œäº†é€‚åº”æ€§çš„è°ƒæ•´è€Œæ¥ã€‚ç›®å‰æ”¯æŒåŸºäºå†…å­˜ã€æ–‡ä»¶ç³»ç»Ÿä¸¤ç§ç¼“å­˜æ–¹å¼ï¼Œä¸”æ­¤ä¸¤ç§ç¼“å­˜æ–¹å¼å¯ä»»æ„ç»„åˆã€‚å¯¹äºç“¦ç‰‡ç¼“å­˜å¤„ç†ç­–ç•¥ï¼Œç›®å‰æ”¯æŒSeedã€Reseedã€Truncateä¸‰ç§ï¼Œä¸GWCä¿æŒä¸€è‡´ã€‚\nGACçš„åŸºæœ¬ç†å¿µ GWCä¸­å£°æ˜å¹¶å¼ºè°ƒTileLayerçš„æ¦‚å¿µï¼Œå¹¶åŸºäºæ­¤æŠ½è±¡ï¼Œç”¨ä»¥é€‚é…æ•°æ®æ¥æºä¸ç“¦ç‰‡å­˜å‚¨ï¼ˆç¼“å­˜ï¼‰ã€‚ä¹Ÿå°±å¦‚åŒGeoServerä¸­ï¼Œä¸€ä¸ªå›¾å±‚å¦‚æœéœ€è¦æ‹¥æœ‰ç¼“å­˜èƒ½åŠ›ï¼Œé‚£ä¹ˆè¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªTileLayerï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªæ‹¥æœ‰ç¼“å­˜çš„å›¾å±‚ï¼Œå°†ä¼šåŒæ—¶æŒæœ‰ä¸¤ä¸ªLayerï¼Œä¸€ä¸ªæ˜¯ Map Layerï¼ˆFeatureTypeï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯TileLayerã€‚ TileLayerä¸­è¿›è¡Œç“¦ç‰‡å­˜å‚¨ç›¸å…³å†…å®¹çš„é…ç½®ï¼Œå¯ä»¥éšæ„é…ç½®å­˜å‚¨å®¹å™¨å¯¹è±¡ï¼ˆæ–‡ä»¶ç³»ç»Ÿã€å¯¹è±¡å­˜å‚¨ã€æ•°æ®åº“ç­‰ï¼‰ã€‚\nè€Œç›®å‰Geo Atlas Cacheçš„å®ç°åˆ™å°†å¤§å¤§ç®€åŒ–è¿™ä¸€æ“ä½œï¼Œæ²¡æœ‰TileLayerå¯¹è±¡ï¼Œå…¨å±€å…±ç”¨åŒä¸€ä¸ªå­˜å‚¨å®¹å™¨å¯¹è±¡ï¼Œæ— éœ€ç¹ççš„å­˜å‚¨é…ç½®ï¼Œé€šè¿‡è‡ªåŠ¨è£…é…å¿«é€Ÿå¯ç”¨ç¼“å­˜ï¼Œæˆ‘è®¤ä¸ºè¿™æ˜¯ä¸­å°é¡¹ç›®ä¸­æ‰€éœ€è¦çš„ã€‚\nç›®å‰å¯¹äºç“¦ç‰‡ç¼“å­˜ï¼ˆTile Cacheï¼‰çš„æ¸…ç†ï¼Œä¹Ÿå°±æ˜¯åŒGWCä¸­æä¾›çš„Seedã€Reseedã€Truncateä¸€èˆ¬ã€‚Truncateåªéœ€æŒæœ‰BlobStoreçš„å¥æŸ„å³å¯å®Œæˆï¼Œä½†Seedå’ŒReseedåˆ™éœ€å‰å¾€æ•°æ®çš„æºç«¯è·å–ç“¦ç‰‡ï¼Œè¿›è€Œæ‰å¯å®Œæˆæ“ä½œï¼Œä¹Ÿå°±æ˜¯éœ€è¦æŒæœ‰è·å–æºç«¯ç“¦ç‰‡Generateçš„å¥æŸ„æ‰å¯ã€‚æˆ–è®¸è¿™å°±æ˜¯ä¸ºä»€ä¹ˆGWCä¸­æå‡ºTileLayerçš„åŸå› ä¹‹ä¸€ä¹Ÿæœªå¯çŸ¥ ğŸ˜®ã€‚ ä¸è¿‡ï¼Œæˆ‘å´ç”±æ­¤è®¤ä¸ºGWCçš„è¾¹ç•Œä¸æ¸…æ™°ï¼Œæˆ‘è®¤ä¸ºç¼“å­˜å°±åšç¼“å­˜çš„äº‹æƒ…å°±å¯ä»¥äº†ï¼Œåº”å½“æŠŠLayerã€TileMatrixSetï¼ˆGridSetï¼‰å’ŒCacheåˆ†å¼€ã€‚ä½†å¦‚æ­¤ï¼Œè‹¥æƒ³è¦æ”¯æŒSeedå’ŒReseedè¿™ä¸¤ç§ç»™ç­–ç•¥çš„è¯ï¼Œè‡³å°‘éœ€è¦æä¾›ä¸€ä¸ªæ‹“å±•ç‚¹æ‰å¯ã€‚æˆ‘åœ¨æ­¤å°†å…¶å‘½åä¸ºTileSourceï¼Œæ˜¯ä¸ºCacheä¸Sourceï¼ˆæºç«¯ç“¦ç‰‡ï¼‰ä¹‹é—´çš„é€‚é…ç»„ä»¶ã€‚å…¶å®ï¼Œè¿™ä¸ä¹Ÿæ˜¯ä¸€ç§ç­‰åŒTileLayerçš„å­˜åœ¨ï¼Œä½†æˆ‘å¹¶ä¸é€šè¿‡Layeræ¥è¿›è¡Œå…³è”æ§åˆ¶ï¼Œä¹Ÿæ²¡æœ‰TileLayerçš„æ¦‚å¿µï¼Œç¼“å­˜å°±æ˜¯ç¼“å­˜ã€‚\nGACçš„è®¾è®¡ä¸å®ç° å› ä¸ºGeoServeræ²‰é‡çš„å†å²åŒ…è¢±ä»¥åŠå¤§è€Œå…¨çš„è‡ƒè‚¿ï¼Œæ‰€ä»¥æœ‰äº†Geo Atlasé¡¹ç›®ã€‚GACä¹Ÿå°†å»¶ç»­æ­¤ç†å¿µï¼Œå»é™¤Cacheç‰¹å®šäºLayerçš„æ¦‚å¿µï¼Œæ— éœ€ä¸ºå›¾å±‚å•ç‹¬é…ç½®ç¼“å­˜ï¼Œå› ä¸ºç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ä½¿ç”¨ç›¸åŒçš„ç¼“å­˜é…ç½®ã€‚åŒæ—¶ï¼Œä»–åº”è¯¥æ˜¯å¯ä»¥è¢«å¿«é€Ÿé›†æˆï¼Œä¸”æ˜“äºé…ç½®çš„ã€‚ä¸ºäº†æå‡ç¼“å­˜ç»„ä»¶çš„æ˜“ç”¨æ€§ã€å…¼å®¹æ€§åŠç¨³å®šæ€§ï¼Œè‡³å°‘åº”è¯¥æä¾›ä¸¤ç§ä¸åŒçš„ç¼“å­˜å­˜å‚¨å¯¹è±¡ï¼Œä¸”å…¶ä¸­ä¸€ç§åº”è¯¥æ˜¯åŸºäºå†…å­˜çš„ï¼Œå¦å¤–ä¸€ç§æ˜¯æ”¯æŒæŒä¹…åŒ–çš„ã€‚å½“æ•°æ®é‡å¾ˆå°‘æ—¶ï¼Œå¯ä»¥å…³é—­ç¼“å­˜æˆ–ä»…å¼€å¯å†…å­˜ç¼“å­˜ï¼›å½“æ•°æ®é‡è¾ƒå¤§æ—¶ï¼Œå¯ä»¥ä»…å¼€å¯æŒä¹…åŒ–ç¼“å­˜æˆ–åŒæ—¶å¼€å¯å†…å­˜ç¼“å­˜ã€‚å†…å­˜ç¼“å­˜ä¸å¯æŒä¹…åŒ–ç¼“å­˜å¯è‡ªç”±æ­é…ï¼Œä»»æ„ç»„åˆã€‚å½“ä¸¤è€…å…¨å¼€å¯æ—¶ï¼Œå¯å½¢æˆä¸¤çº§ç¼“å­˜ï¼Œæ­¤æ—¶éœ€æ³¨æ„ä¸¤çº§ç¼“å­˜é—´æ•°æ®çš„åŒæ­¥ã€‚\nGACçš„éœ€æ±‚ä¸è®¾è®¡ æ¥ä¸‹æ¥ï¼Œå†æ¬¡ç¡®å®šä¸€ä¸‹GACçš„éœ€æ±‚ï¼š\næ”¯æŒçŸ¢é‡ç“¦ç‰‡ç¼“å­˜ æä¾›ä¸¤ç±»ç¼“å­˜å­˜å‚¨å¯¹è±¡ï¼Œå…¶ä¸­ä¸€ç§åº”è¯¥æ˜¯åŸºäºå†…å­˜çš„ï¼Œå¦å¤–ä¸€ç§æ˜¯æ”¯æŒæŒä¹…åŒ–çš„ï¼Œä¸”ä¸¤è€…å¯ä»»æ„ç»„åˆï¼ŒåŒæ—¶å¼€å¯å¯å½¢æˆäºŒçº§ç¼“å­˜ç»“æ„ æä¾›Seedã€Reseedã€Truncateæ­¤ä¸‰ç§ç“¦ç‰‡ç¼“å­˜æ¸…ç†ç­–ç•¥ å…¨å±€å…±ç”¨åŒä¸€ä¸ªç¼“å­˜å­˜å‚¨å¯¹è±¡ï¼Œæä¾›å¿«é€Ÿé›†æˆèƒ½åŠ› å…¶ä¸­ï¼ŒäºŒçº§ç¼“å­˜æ˜¯æ­¤å‰æ²¡æœ‰æ¥è§¦è¿‡çš„å†…å®¹ã€‚ç»“åˆè‡ªæˆ‘è‡†æƒ³ï¼Œç»™å‡ºäº†å¦‚ä¸‹è®¾æƒ³ ğŸ«£ï¼š\næ­¤äºŒçº§ç¼“å­˜ï¼Œå¯è‡ªè¡Œç¡®å®šç»„åˆæ–¹å¼ï¼Œå¹¶ééœ€è¦ä¸¤è€…åŒæ—¶å¼€å¯ã€‚éš¾ç‚¹ï¼šçŠ¶æ€åŒæ­¥ï¼ˆæ•°æ®ä¸€è‡´æ€§ï¼‰\nä¸€çº§ç¼“å­˜ï¼ˆåŸºäºå†…å­˜ï¼‰ï¼š Local Mem Cache + LRU Guava Caffeine äºŒçº§ç¼“å­˜ï¼ˆå¯æŒä¹…åŒ–ï¼‰ï¼šOuter Cache Redis File System Database GeoPackage æ¯ä¸€ä¸ªLevelä¸€ä¸ªgpkgæ–‡ä»¶ï¼Œæå‡å¹¶å‘è¯»å†™èƒ½åŠ›ï¼ˆæ”¯æŒé…ç½®ä¸ºæ‰€æœ‰Levelç”¨ä¸€ä¸ªgpkgï¼Œä½†æ˜¯ä¸æ¨èï¼‰ PostGIS ä¸è¿‡ï¼Œåœ¨ç»è¿‡ä¸€ç•ªè°ƒç ”ä¹‹åï¼Œè¿˜æ˜¯å†³å®šæŠ„GeoWebCacheçš„ä½œä¸š ğŸ˜§ã€‚ä¸€æ˜¯ç¡®å®æœ‰ä¸€å®šçš„éš¾åº¦ï¼ŒäºŒæ˜¯ç›®å‰æ—¶é—´æœ‰é™ï¼ŒGAPä¸­çš„æˆ‘æ—©å·²ç‘Ÿç‘Ÿå‘æŠ– ğŸ™„ã€‚æœ€é‡è¦çš„æ˜¯ï¼ŒGeoWebCacheä¸­çš„MemoryBlobStoreå·²ç»å®ç°äº†ä¸Šè¿°äºŒçº§ç¼“å­˜çš„éœ€æ±‚å‘€ ğŸ«¡ï¼Œå¦‚æ­¤æ“ä½œå¯ç›´æ¥è¦†ç›–æ‰å‰ä¸‰ä¸ªéœ€æ±‚ã€‚è€Œæ­¤æ—¶äºŒçº§ç¼“å­˜çš„å®ç°ç¡®å®šä¸ºï¼š\nåŸºäºå†…å­˜çš„ç¼“å­˜ï¼ˆGuavaï¼‰ åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„ç¼“å­˜ éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œæ­¤MemoryBlobStoreäºŒçº§ç¼“å­˜æ˜¯å¯æ‹“å±•æ¶æ„ï¼Œåç»­å¯è‡ªè¡Œæ‹“å±•ä¸åŒçš„Providerã€‚\nğŸ’¡ å¯¹äºSeedä¸Reseedçš„å¤„ç†ï¼Œåˆ™ä¸GACçš„ç†å¿µä¸­æ‰€è¿°ä¸€è‡´ï¼Œé€šè¿‡TileSourceå¯¹å¤–æä¾›æ‹“å±•ã€‚ä¹Ÿå°±æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼ŒCacheæ¨¡å—åªæä¾›Seedä¸Reseedçš„å£°æ˜ï¼Œæ— æ³•æä¾›å…·ä½“å®ç°ï¼ˆæ— æ³•ç›´æ¥ä¸Sourceè¿›è¡Œé“¾æ¥ï¼‰ã€‚\né‚£ä¹ˆæ­¤åˆ»åªå‰©ä¸‹æœ€åä¸€ä¸ªéœ€æ±‚äº†ï¼Œå…¶ä¸»æ—¨å›´ç»•å¿«é€Ÿé…ç½®ã€æ˜“ç”¨ã€‚åœ¨æ­¤åŸºäºGeoWebCacheä¸­çš„DefaultStorageBroker ç±»è¿›è¡Œç¼“å­˜å­˜å‚¨å¯¹è±¡çš„ä»£ç†ï¼Œå…¶ç¬¦åˆGWCä¸­ç¼“å­˜å­˜å‚¨å¯¹è±¡è®¾è®¡æ¶æ„ï¼Œä¹Ÿä¸ºåç»­æä¾›äº†æ›´å¤šçš„æ‹“å±•ç‚¹ï¼ŒåŒæ—¶å°†å…¶æš´éœ²ç»™å…¨å±€ï¼Œå³å…¨å±€å…±ç”¨çš„ç¼“å­˜å­˜å‚¨å¯¹è±¡ã€‚å¯¹äºå¿«é€Ÿé›†æˆèƒ½åŠ›ï¼Œæ­¤å¤„å°†ç»“åˆSpring Bootçš„AutoConfigurationç‰¹æ€§ï¼Œä¸ºGACæä¾›è‡ªåŠ¨è£…é…èƒ½åŠ›ã€‚ä¸æ­¤åŒæ—¶ï¼Œå°†ç¼“å­˜å­˜å‚¨å¯¹è±¡çš„å¯è®¾ç½®å±æ€§é€šè¿‡é…ç½®çš„æ–¹å¼æš´éœ²å‡ºæ¥ï¼Œå¯ç›´æ¥åœ¨application.ymlæˆ–application.propertiesä¸­è¿›è¡Œé…ç½®ã€‚å…·ä½“å¯é…ç½®å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š\ngeo-atlas.cache.enabled=falseï¼ˆæ˜¯å¦å¯ç”¨ç¼“å­˜ï¼Œé»˜è®¤ä¸ºfalseï¼‰ geo-atlas.cache.inner-caching-enabled=falseï¼ˆæ˜¯å¦å¯ç”¨å†…å­˜ç¼“å­˜ï¼Œé»˜è®¤ä¸ºfalseï¼‰\ngeo-atlas.cache.inner.storage.provider=guavaï¼ˆå¯é€‰å€¼ï¼šguavaï¼Œæš‚ä¸æ”¯æŒï¼Œä¿ç•™ï¼‰\ngeo-atlas.cache.inner.storage.memory-limit=16ï¼ˆå†…å­˜å¤§å°é™åˆ¶ï¼Œå•ä½MBï¼Œé»˜è®¤16ï¼‰\ngeo-atlas.cache.inner.storage.concurrency-level=4ï¼ˆç¼“å­˜å¹¶å‘çº§åˆ«çš„é»˜è®¤å€¼ï¼Œé»˜è®¤ä¸º4ï¼‰\ngeo-atlas.cache.inner.storage.eviction-policy=nullï¼ˆç¼“å­˜é©±é€æ”¿ç­–ï¼Œå³ç¼“å­˜æ·˜æ±°ç®—æ³•ï¼Œå¯é€‰å€¼ï¼šNULLã€LRUã€LFUã€EXPIRE_AFTER_WRITEã€EXPIRE_AFTER_ACCESSï¼Œé»˜è®¤å€¼ä¸ºNULLï¼‰\nğŸ’¡ LRUã€LFUæš‚æ—¶ä¸æ”¯æŒ\ngeo-atlas.cache.inner.storage.eviction-time=2*60ï¼ˆç¼“å­˜é©±é€æ—¶é—´çš„é»˜è®¤å€¼ï¼Œå•ä½ï¼šç§’ï¼Œé»˜è®¤ï¼š2 minutesï¼‰\ngeo-atlas.cache.persistence-enabled=falseï¼ˆæ˜¯å¦å¯ç”¨æŒä¹…åŒ–ç¼“å­˜ï¼Œé»˜è®¤ä¸ºfalseï¼‰ geo-atlas.cache.persistence.storage.provider=file-systemï¼ˆæŒä¹…åŒ–ç¼“å­˜å­˜å‚¨ç­–ç•¥å¯¹è±¡ï¼Œå¯é€‰å€¼ï¼šfile-systemã€geopackageï¼Œç°åªæ”¯æŒfile-systemï¼‰ geo-atlas.cache.persistence.storage.base-directoryï¼ˆå³æœ€ç»ˆç“¦ç‰‡æŒä¹…åŒ–çš„ç›®å½•åŸºç¡€è·¯å¾„ï¼Œé»˜è®¤è¯»å–ï¼šjava.io.tmpdirï¼Œå¯æ‹“å±•ï¼‰ geo-atlas.cache.persistence.storage.file-system.path-generator-type=defaultï¼ˆå³ç“¦ç‰‡å­˜å‚¨è·¯å¾„ç®—æ³•ï¼Œå¯é€‰å€¼ï¼šdefaultã€tmsã€xyzï¼Œé»˜è®¤ä¸ºdefaultï¼‰\ngeo-atlas.cache.persistence.storage.fs.block-size=4096ï¼ˆThe default block size is 4096 bytes.ï¼‰\nThis setting determines how the tile cache calculates disk usage. The value for this setting should be equivalent to the disk block size of the storage medium where the cache is located. The default block size is 4096 bytes.ï¼ˆæ­¤è®¾ç½®ç¡®å®šåˆ‡ç‰‡ç¼“å­˜å¦‚ä½•è®¡ç®—ç£ç›˜ä½¿ç”¨æƒ…å†µã€‚ è¯¥è®¾ç½®çš„å€¼åº”ç­‰äºç¼“å­˜æ‰€åœ¨å­˜å‚¨ä»‹è´¨çš„ç£ç›˜å—å¤§å°ã€‚ é»˜è®¤å—å¤§å°ä¸º 4096 å­—èŠ‚ã€‚ï¼‰\nğŸ’¡ ç›®å‰è¯¥è®¾ç½®åº”æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œæ¯•ç«Ÿåˆæ²¡åšç£ç›˜ä½¿ç”¨æƒ…å†µçš„ç»Ÿè®¡ã€‚ ğŸ¤¨\nGACçš„å®ç° æ—¢ç„¶å†³å®šæŠ„GeoWebCacheçš„ä½œä¸šï¼Œé‚£ä¸»è¦å†…å®¹å°±æ˜¯å¯¹å…¶Cacheéƒ¨åˆ†å†…å®¹è¿›è¡Œç§»æ¤ï¼ŒåŒæ—¶å°†Geo Atlasçš„å¼€æºåè®®å˜æ›´ä¸ºLGPLï¼ˆMIT â†’ LGPLï¼‰ã€‚å½“æ‰€æœ‰å†…å®¹éƒ½è¢«è‡ªæˆ‘å¸æ”¶è½¬æ¢åï¼Œå°±å¯ä»¥è‡ªç”±æ§åˆ¶åè®®äº†ï¼Œæ¯”å¦‚å†è½¬ä¸ºMITæˆ–Apacheã€‚\nBlobStore è¿™é‡Œå¯ä»¥å…ˆçœ‹ä¸€ä¸‹BlobStoreçš„ç°æœ‰ç»“æ„è®¾è®¡ï¼ŒBlobStoreæ˜¯ç¼“å­˜å­˜å‚¨å¯¹è±¡çš„é¡¶å±‚æ¥å£ï¼ŒMemoryBlobStoreã€FileBlobStoreã€NullBlobStoreç­‰å‡æ˜¯BlobStoreçš„å…·ä½“å®ç°ã€‚è¿™é‡Œå¯ä»¥æ³¨æ„åˆ°MemoryBlobStoreä¸­æœ‰ä¸€ä¸ªstoreå±æ€§ï¼ˆç±»å‹ä¸ºBlobStoreï¼‰å’Œä¸€ä¸ªcacheProviderå±æ€§ï¼ˆç±»å‹ä¸ºCacheProviderï¼‰ï¼Œè¿™ä¹Ÿå°±æ˜¯å‰é¢æåˆ°çš„äºŒçº§ç¼“å­˜å®ç°ã€‚\nå±•å¼€MemoryBlobStoreï¼Œå¯ä»¥ä»å…¶æ„é€ å‡½æ•°å‘ç°ï¼Œé»˜è®¤æƒ…å†µä¸‹åªæä¾›äº†åŸºäºGuavaçš„å†…å­˜ç¼“å­˜ï¼ŒåŒ…è£…çš„BlobStoreæ˜¯ä¸€ä¸ªç©ºå®ç°ï¼Œä¸”åœ¨æ­¤å¤„æ³¨é‡Šï¼Œå‘ŠçŸ¥å…¶é»˜è®¤è¡Œä¸ºå’Œæç¤ºçš„æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒ…è£…çš„BlobStoreå®ä¾‹å¯¹è±¡å¯ä»¥æ˜¯BlobStoreæ¥å£çš„ä»»æ„å®ç°ï¼Œæˆ‘åœ¨æ­¤å°†ä½¿ç”¨åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„å®ç°ï¼ˆFileBlobStoreï¼‰è¿›è¡Œå¡«å……ã€‚\næœ€ç»ˆï¼Œå°†äºŒçº§ç¼“å­˜æ„å»ºçš„æ•´ä½“é€»è¾‘ç»“åˆå¯é…ç½®æ€§å°è£…äºä¸€ä¸ªæ³¨å†Œç±»ä¸­ï¼Œåœ¨æ­¤å°†å…¶å‘½åä¸ºï¼šStorageBrokerRegisterï¼Œæ­¤å³ä¸ºå…¨å±€å…±ç”¨çš„ç¼“å­˜å­˜å‚¨å¯¹è±¡ï¼Œä¸»è¦ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\npublic class StorageBrokerRegister implements EnvironmentAware, ImportBeanDefinitionRegistrar { private static final Logger log = LoggerFactory.getLogger(StorageBrokerRegister.class); private static final String FILE_SYSTEM_PROVIDER = \"file-system\"; private static final String GEO_PACKAGE = \"geo-package\"; private Environment environment; private DefaultStorageFinder storageFinder = new DefaultStorageFinder(null); @Override public void setEnvironment(Environment environment) { this.environment = environment; } @Override public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) { // FIXME: 2024/5/10 å…¶å®ç›®å‰TransientCacheå¹¶æ²¡æœ‰ä»€ä¹ˆä½¿ç”¨åœºæ™¯ï¼Œä¸è¿‡æš‚æ—¶å…ˆç•™ä¸‹ // TransientCache æ—©äºMemoryStoreå‡ºç°, å‰è€…åº”è¯¥æ˜¯2012å¹´, åè€…åº”è¯¥æ˜¯2014å¹´ TransientCache transientCache = new TransientCache(100, 1024, 2000); BlobStore blobStore = new NullBlobStore(); Boolean cacheEnabled = getApplicationValue(GeoAtlasCacheEnvKeys.getCacheEnabled(), Boolean.class, Boolean.FALSE); if (cacheEnabled) { Boolean innerCachingEnabled = getApplicationValue(GeoAtlasCacheEnvKeys.getInnerCachingEnabled(), Boolean.class, Boolean.FALSE); Boolean persistenceEnabled = getApplicationValue(GeoAtlasCacheEnvKeys.getPersistenceEnabled(), Boolean.class, Boolean.FALSE); if (innerCachingEnabled) { MemoryBlobStore memoryBlobStore = buildInnerCache(); if (persistenceEnabled) { memoryBlobStore.setStore(buildPersistenceCache()); } blobStore = memoryBlobStore; }else if (persistenceEnabled) { blobStore = buildPersistenceCache(); }else { log.warn(\"The cache configuration can be turned on, but the memory cache and persistent cache are turned off and cannot be further configured.\" + \" Please check your configuration items.\"); log.warn(\"This blobStore configuration fails and will enter a no-cache state.\"); } } BeanDefinitionBuilder builder = BeanDefinitionBuilder.genericBeanDefinition(DefaultStorageBroker.class); builder.addConstructorArgValue(blobStore).addConstructorArgValue(transientCache); AbstractBeanDefinition beanDefinition = builder.getBeanDefinition(); beanDefinition.setSynthetic(true); registry.registerBeanDefinition(\"storageBroker\", beanDefinition); log.info(\"The BlobStore registration is complete\"); } ... } Seedã€Reseed\u0026Truncate å¯¹äºTruncateæ¥è¯´ï¼Œç›´æ¥è¿›è¡Œå…¨é¢ç§»æ¤å³å¯ã€‚ç”±äºæ­¤å¤„ç§»é™¤äº†TileLayeræ¦‚å¿µï¼Œæ‰€ä»¥Seedä¸Reseedæ— æ³•å…¨é¢ç§»æ¤å¤„ç†ï¼Œè€Œæ˜¯ä»…ç§»æ¤å…¶æœ€ç»ˆå®ç°éƒ¨åˆ†ï¼Œå¯¹äºè¿™ä¸¤è€…ä¸æºç«¯ç“¦ç‰‡çš„é“¾æ¥åˆ™é€šè¿‡TileSourceæ¥å£æ¥å®ç°ã€‚å³é»˜è®¤æƒ…å†µä¸‹ï¼ŒGACæ— æ³•æä¾›å®Œæ•´çš„Seedä¸ReseedåŠŸèƒ½ï¼Œéœ€è¦æ¥å…¥ç«¯å®ç°TileSourceä¸­çš„seedTileæ–¹æ³•ï¼ŒGACä¸­ä»…æä¾›ä¸€ä¸ªTileSourceçš„ç©ºå®ç°ã€‚\npublic interface TileSource { /** * å³é»˜è®¤ä¸ä½¿ç”¨MetaTiles */ int[] META_TILING_FACTORS = {1,1}; /** * The size of a metatile in tiles. * * @return the {x,y} metatiling factors */ default int[] getMetaTilingFactors() { return META_TILING_FACTORS; } void seedTile(ConveyorTile tile, boolean tryCache) throws GeoAtlasCacheException, IOException; } public abstract class AbstractTileSource implements TileSource{ private final Logger log = LoggerFactory.getLogger(getClass()); protected static final ThreadLocal\u003cByteArrayResource\u003e TILE_BUFFER = new ThreadLocal\u003c\u003e(); public void seedTile(ConveyorTile tile, boolean tryCache) throws GeoAtlasCacheException, IOException { // Cacheæ¨¡å—æ— æ³•è‡ªä¸»æ‰§è¡Œseed\u0026reseedæ“ä½œï¼Œéœ€è¦é›†æˆæ–¹è‡ªè¡Œå®ç° if (log.isWarnEnabled()){ log.warn(\"The Cache module cannot perform seed \u0026 reseed operations autonomously, and the integrator needs to implement it by itself.\"); } } protected void transferTile(TileObject tile, ConveyorTile tileProto, long requestTime, boolean persistent) throws GeoAtlasCacheException { ByteArrayResource resource = this.getTileBuffer(TILE_BUFFER); // copy resource tileProto.setBlob(resource); try { writeTileToStream(tile, resource); tile.setCreated(requestTime); if (persistent){ tileProto.getStorageBroker().put(tile); } tileProto.getStorageObject().setCreated(tile.getCreated()); } catch (StorageException var18) { throw new GeoAtlasCacheException(var18); } catch (IOException e) { log.error(\"Unable to write image tile to ByteArrayOutputStream\", e); } } protected ByteArrayResource getTileBuffer(ThreadLocal\u003cByteArrayResource\u003e tl) { ByteArrayResource buffer = (ByteArrayResource) tl.get(); if (buffer == null) { buffer = new ByteArrayResource(16 * 1024); tl.set(buffer); } buffer.truncate(); return buffer; } public boolean writeTileToStream(final TileObject raw, Resource target) throws IOException { try (OutputStream outStream = target.getOutputStream()) { IOUtils.copy(raw.getBlob().getInputStream(), outStream); } return true; } } // GACä¸­TileSourceçš„é»˜è®¤å®ç° public class DefaultTileSource extends AbstractTileSource { } ğŸ’¡ è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒGWCä¸­æœ‰ä¸€ä¸ªMetatilesæŠ€æœ¯ï¼Œæ˜¯ä¸€ä¸ªé’ˆå¯¹åœ°å›¾ç“¦ç‰‡ï¼ˆPNG|JPEGï¼‰çš„ä¼˜åŒ–æŠ€æœ¯ã€‚ä½†æ˜¯åœ¨GWCç°æœ‰çš„æ¶æ„ç»„ç»‡ä¸Šï¼ŒMetatilesæ˜¯æ— æ³•æ”¯æŒçŸ¢é‡ç“¦ç‰‡æŠ€æœ¯çš„ï¼Œä¹Ÿå°±æ˜¯ä¼šè¿˜åŸä¸º1x1çš„ç»„åˆã€‚æ‰€ä»¥æˆ‘åœ¨æ­¤å¤„ç›´æ¥å°†Metatilesé»˜è®¤è®¾ç½®ä¸º1x1çš„ç»„åˆï¼ŒåŒæ—¶æš‚æ—¶å»é™¤äº†ç“¦ç‰‡è½¬å­˜éƒ¨åˆ†ä¸­Metatilesæ‹†åˆ†é€»è¾‘ã€‚\nTileMatrixSubsetæ‹“å±• å…ˆè®²ä¸€ä¸‹å½“æŒ‡å®šBBoxåï¼ŒTruncateã€Seedã€Reseedçš„å¤§ä½“æ‰§è¡Œé€»è¾‘ã€‚GACå¯¹äºç“¦ç‰‡æ¸…ç†ç­–ç•¥çš„æ‰§è¡Œä¸GWCä¿æŒé«˜åº¦ä¸€è‡´ï¼ŒåŒæ ·æ”¯æŒæŒ‡å®šBBoxè¿›è¡Œç“¦ç‰‡æ¸…ç†ï¼ŒBBoxç”¨äºé™å®šå¯æ¸…ç†èŒƒå›´ã€‚åœ¨å‰æ–‡ä¸­å¯¹äºTileMatrixSetå’ŒTileMatrixSubsetåšè¿‡è§£é‡Šï¼Œå‰è€…ç”¨äºå®šä¹‰ç“¦ç‰‡çŸ©é˜µé›†ï¼Œåè€…ç”¨äºåœ¨ç“¦ç‰‡çŸ©é˜µé›†ä¸­æè¿°æ•°æ®çš„å®é™…èŒƒå›´ï¼ŒåŒæ—¶é™å®šç“¦ç‰‡å¯è¯·æ±‚çš„èŒƒå›´ï¼Œæ­¤ä¸¤è€…åˆ†åˆ«å¯¹åº”GWCä¸­çš„GridSetåŠGridSubsetã€‚åœ¨GWCæºå¸¦BBoxçš„ç“¦ç‰‡æ¸…ç†ç­–ç•¥æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šè·å–å¯¹åº”TileLayerçš„GridSubsetï¼Œå¹¶ä¸ç»™å®šçš„BBoxè®¡ç®—ç›¸äº¤èŒƒå›´ï¼Œè€Œåå°±å¯ä»¥ç²¾ç¡®çš„ç¡®å®šå“ªäº›ç“¦ç‰‡æ˜¯éœ€è¦è¢«æ¸…ç†çš„äº†ã€‚å¯¹äºGACæ¥è¯´ï¼Œå¹¶æ²¡æœ‰å¦‚TileLayerçš„æ¦‚å¿µï¼Œä¹Ÿæ— æ³•ä¸æºç«¯æˆ–å›¾å±‚ï¼ˆFeatureLayerï¼‰è¿›è¡Œç›´æ¥é“¾æ¥ï¼Œæ‰€ä»¥æ˜¯æ— æ³•è·å–åˆ°å›¾å±‚æ‰€æŒæœ‰çš„TileMatrixSubsetå¯¹è±¡ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚\nå½“ç„¶ï¼Œå¹¶ä¸æ˜¯è¯´æ²¡æœ‰TileMatrixSubsetå¯¹è±¡å°±æ— æ³•è¿›è¡Œç“¦ç‰‡ç¼“å­˜çš„æ¸…ç†äº†ã€‚å°±æ‹¿æˆ‘ä»¬å®é™…åº”ç”¨ä¸­å¤§éƒ¨åˆ†åœºæ™¯æ¥è¯´ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨åŸºäºWebå¢¨å¡æ‰˜æˆ–CGCS2000ç»çº¬åº¦ç­‰é—´éš”ç›´æŠ•çš„ç“¦ç‰‡çŸ©é˜µé›†ä½œä¸ºTileMatrixSetï¼Œç”¨æ•°æ®çš„å®é™…èŒƒå›´æ„å»ºTileMatrixSubsetã€‚æ­¤æ—¶å¯è®¤ä¸ºå‰è€…ä¸ºå…¨çƒèŒƒå›´ï¼Œåè€…ä¸ºå±€éƒ¨èŒƒå›´ã€‚ä½†æ— è®ºä¸å…¨çƒèŒƒå›´è¿˜æ˜¯å±€éƒ¨èŒƒå›´è¿›è¡Œç›¸äº¤è®¡ç®—ï¼Œå…¶æœ€ç»ˆè®¡ç®—ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œéƒ½æ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œçš„ã€‚åªä¸è¿‡ç›´è§‰å‘Šè¯‰æˆ‘ï¼Œä½¿ç”¨å±€éƒ¨èŒƒå›´è®¡ç®—åº”è¯¥ä¼šæ›´å¿«ä¸€äº› ä¹Ÿæœªå¯çŸ¥å•Š ğŸ¤”ï¼ˆæˆ‘æ²¡æœ‰æ•°æ®æ”¯æŒï¼Œçº¯å±çå’§å’§ ğŸ˜›ï¼‰ï¼Œæ‰€ä»¥ç»§ç»­ç•™ä¸‹TileMatrixSubsetçš„æ‹“å±•ç‚¹ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒGACæ˜¯æ— æ³•è·å–åˆ°å›¾å±‚çš„TileMatrixSubsetå¯¹è±¡çš„ï¼Œé‚£ä¹ˆä¼šä½¿ç”¨TileMatrixSetå¯¹åº”çš„èŒƒå›´è¿›è¡ŒTileMatrixSubsetçš„æ„å»ºã€‚å¯èƒ½ä½ ä¼šé—®ï¼Œæ—¢ç„¶å¯ä»¥åœ¨å…¨å±€è·å–åˆ°TileMatrixSetå¯¹è±¡ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆå°±ä¸èƒ½å¦‚æ­¤å¤„ç†TileMatrixSubsetå¯¹è±¡å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºTileMatrixSetæ˜¯å¼ºåˆ¶éœ€è¦æœ‰çš„ï¼Œè€Œä¸”Geo Atlasä¸­çš„TileMatrixSetå¹¶ä¸ä¸å›¾å±‚ç»‘å®šï¼Œå£°æ˜å³æ”¯æŒï¼›è€ŒTileMatrixSubsetæ˜¯å¯é€‰çš„ï¼Œä¸”æ˜¯ç‰¹å®šäºå›¾å±‚çš„ï¼Œæ‰€ä»¥æ— æ³•å¦‚æ­¤è®¾ç½®ã€‚\npublic abstract class AbstractTileSeedService implements TileSeedService{ private TileBreeder breeder; public AbstractTileSeedService(TileBreeder breeder) { this.breeder = breeder; } public void doSeed(SeedRequest request) throws GeoAtlasCacheException { TileMatrixSet matrixSet = TileMatrixSetContext.getTileMatrixSet(request.getMatrixSetId()); if (matrixSet == null) { throw new GeoAtlasCacheException(\"TileMatrixSet not found\"); } breeder.seed(request, getSubset(request, matrixSet)); } /** * å¿…é¡»å®ç°è·å–subsetçš„æ–¹æ³• * @param request * @param matrixSet * @return */ protected abstract TileMatrixSubset getSubset(SeedRequest request, TileMatrixSet matrixSet) throws GeoAtlasCacheException; } public class DefaultTileSeedService extends AbstractTileSeedService{ public DefaultTileSeedService(TileBreeder breeder) { super(breeder); } @Override protected TileMatrixSubset getSubset(SeedRequest request, TileMatrixSet matrixSet) throws GeoAtlasCacheException { // ç”±äºç›®å‰å¹¶ä¸å­˜åœ¨å¦‚Tile Layerçš„æ¦‚å¿µ, æ‰€ä»¥åœ¨Cacheæ¨¡å—é‡Œé¢æ— æ³•è·å–åˆ°FeatureLayerçš„TileMatrixSubset, æ‰€ä»¥è¿™é‡Œç›´æ¥è¿”å›null, // é‚£ä¹ˆå°†ä¼šä½¿ç”¨ requestä¸­ç»™å®šçš„matrixSetId æ¥åˆ›å»º TileMatrixSubset(ä¹Ÿå°±æ˜¯æ˜¯ä¸€ä¸ªèŒƒå›´ä¸TileMatrixSetç›¸åŒçš„TileMatrixSubset) // ç»§æ‰¿æ–¹å¯ä»¥è‡ªè¡Œå®ç°è¯¥æ¥å£, ä»è€Œæ³¨å…¥FeatureLayerçš„TileMatrixSubset return null; } } å¿«é€Ÿé›†æˆ æ­¤å¤„åŸºäºSpring Bootçš„AutoConfigurationç‰¹æ€§å¯¹å¤–æä¾›å¿«é€Ÿé›†æˆèƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯è¯´GACæ˜¯å…·å¤‡è‡ªåŠ¨è£…é…åŠŸèƒ½çš„ã€‚è¿™é‡Œå°†éœ€è¦è¢«è‡ªåŠ¨è£…é…çš„å†…å®¹å°è£…åˆ°ä¸€å—ï¼Œå‘½åä¸ºGeoAtlasCacheAutoConfigurationï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°spring.factoriesé…ç½®æ–‡ä»¶ä¸­ã€‚\n@ConditionalOnProperty(value = \"geo-atlas.cache.enabled\", havingValue = \"true\", matchIfMissing = true) @Import(StorageBrokerRegister.class) public class GeoAtlasCacheAutoConfiguration { @Bean @ConditionalOnMissingBean(value = SeederThreadPoolExecutor.class) public SeederThreadPoolExecutor seederThreadPoolExecutor() { return new SeederThreadPoolExecutor(16, 32); } @Bean @ConditionalOnMissingBean(value = TileSource.class) public TileSource tileSource() { return new DefaultTileSource(); } @Bean @ConditionalOnMissingBean(value = TileBreeder.class) public TileBreeder tileBreeder(StorageBroker storageBroker, TileSource tileSource, SeederThreadPoolExecutor stpe) { return new TileBreeder(tileSource, storageBroker, stpe); } @Bean @ConditionalOnMissingBean(value = TileSeedService.class) public TileSeedService tileSeedService(TileBreeder tileBreeder){ return new DefaultTileSeedService(tileBreeder); } @Bean @ConditionalOnMissingBean(value = TileSeedEndpoint.class) public TileSeedEndpoint tileSeedEndpoint(TileSeedService tileSeedService) { return new TileSeedEndpoint(tileSeedService); } } ğŸ’¡ éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œæ­¤å¤„æ‰€è¿°çš„è‡ªåŠ¨è£…é…ï¼Œä»…ä»…åªèƒ½å®Œæˆç¼“å­˜æ¨¡å—çš„è£…é…ï¼Œå¹¶æš´éœ²å‡ºå…¨å±€å”¯ä¸€çš„BlobStoreä»£ç†å¯¹è±¡ï¼šStorageBrokerï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å®Œæˆä¸å›¾å±‚æˆ–æºç«¯çš„é“¾æ¥ï¼Œéœ€è¦æ¥å…¥æ–¹è‡ªè¡Œå¤„ç†ã€‚å¯¹äºGACçš„æ¥å…¥ç¤ºä¾‹ï¼Œå¯å‚è€ƒé™„å½•éƒ¨åˆ†ã€‚\nå°ç»“ GACï¼Œå³Geo Atlas Cacheï¼Œè‡ªæ­¤å·²å…¨éƒ¨å®Œæˆã€‚é€šè¿‡GACå¼€å‘ï¼Œå¯¹äºGWCï¼ˆGeoWebCacheï¼‰çš„ç†è§£åˆå¤šäº†ä¸€äº›ğŸ«£ã€‚\näº‹åŠ¡çš„äº§ç”Ÿå¿…æœ‰å…¶åŸå› ä¸å…¶ä½¿å‘½ï¼Œå³è¦è§£å†³çš„é—®é¢˜ï¼ŒåŒæ—¶è¿˜ä¼šå—äº§ç”Ÿé˜¶æ®µçš„ç¯å¢ƒå½±å“ã€‚GACä¹‹æ‰€ä»¥å‡ºç°æ˜¯å› ä¸ºéœ€è¦æ„å»ºGeo Atlasçš„ç”Ÿæ€ï¼ŒåŒæ—¶å¸Œæœ›å¯ä»¥ä¿æŒç¼“å­˜æ¨¡å—çš„çº¯ç²¹æ€§å’Œæ˜“ç”¨æ€§ï¼Œä¸”å¯ä»¥å¿«é€Ÿè¿›è¡Œé›†æˆï¼Œä»¥ä¾¿æŠ•å…¥é¡¹ç›®å¼€å‘ä¸­ã€‚å—åˆ¶äºä¸ªäººç»å†ä¸çœ¼ç•Œçš„å½±å“ï¼ŒGACã€Geo Atlaså¹¶æ²¡æœ‰è¾¾æˆå…¶ç†æƒ³çš„çŠ¶æ€ï¼Œè™½ä¸å½±å“æ­£å¸¸çš„ä½¿ç”¨ã€‚ï¼ˆè¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªæ‚–è®ºï¼Œäººæ˜¯å¤æ‚çš„ï¼Œæˆ–è®¸æ˜¯å†¥å†¥ä¹‹ä¸­æœ‰äººå‘Šè¯‰æˆ‘ï¼Œè®©æˆ‘æœ‰äº†æ­¤æ®µæè¿°ä¹Ÿæœªå¯çŸ¥å•Š ğŸ˜‘ï¼‰\næˆ‘æ„¿é›†ä¼—å®¶ä¹‹æ‰€é•¿ï¼Œå¡‘äºGeo Atlasã€‚æœŸå¾…ä½ çš„è¿›æ­¥ï¼ŒåŠ æ²¹ï¼\nğŸ’¡ psï¼šæ›´å¤šå®ç°æƒ…å†µï¼Œè¯·å‚è§GACæºç ï¼šGeo Atlas Cache@Github\nå‚è€ƒ JavaäºŒçº§é«˜é€Ÿç¼“å­˜æ¶æ„è®¾è®¡_ç¼“å­˜_å…ƒå¹´æŠ€æœ¯æ´å¯Ÿ_InfoQå†™ä½œç¤¾åŒº\nå¤šçº§ç¼“å­˜ æ¶æ„è®¾è®¡ - ç–¯ç‹‚åˆ›å®¢åœˆ - åšå®¢å›­\nå¾®æœåŠ¡æ¶æ„ä¸­çš„å¤šçº§ç¼“å­˜è®¾è®¡è¿˜æœ‰äººä¸æ‡‚ï¼Ÿ\nå½»åº•å¼„æ‡‚æµè§ˆå™¨ç¼“å­˜ç­–ç•¥\nMBTiles ä¸ SMTiles æ ¼å¼çš„åœ°å›¾ç“¦ç‰‡\nBlobStores â€” GeoServer 2.26.x User Manual\nGeoWebCache Metatiles\né™„å½• GACçš„é›†æˆç¤ºä¾‹ æˆ‘åœ¨ogc-apiæ¨¡å—ä¸­é›†æˆäº†tile-cacheï¼ˆå³GACï¼‰ï¼Œä¸‹é¢å¯¹æœ¬æ¬¡é›†æˆåšç®€è¦æè¿°ï¼š\nç¬¬ä¸€è¦ç´ ï¼Œä¾èµ–\norg.geo-atlas.component tile-cache ${revision} å®ç°æºç«¯ï¼ˆData Sourceï¼‰äºGACçš„é“¾æ¥ \u0026 å®ç°TileSourceæ‹“å±•\n@Component public class DefaultTileGenerator extends AbstractTileSource implements GeoAtlasTileGenerator { private final FeatureSourceHelper featureSourceHelper; private String lockProvider; private transient LockProvider lockProviderInstance; private static final Logger log = LoggerFactory.getLogger(DefaultTileGenerator.class); public DefaultTileGenerator(FeatureSourceHelper featureSourceHelper) { this.featureSourceHelper = featureSourceHelper; } public ConveyorTile generator(ConveyorTile tile) throws IOException, GeoAtlasCacheException, OutsideCoverageException { // FIXME: 2024/5/10 å¯ä»¥å†æ¬¡æ£€æŸ¥ MimeType, åœ¨åº”ç”¨å±‚é¢æ§åˆ¶MimeTypeçš„æ”¯æŒ // checkMimeType(tile); TileMatrixSet tileMatrixSet = TileMatrixSetContext.getTileMatrixSet(tile.getGridSetId()); if (tileMatrixSet == null) { throw new IllegalArgumentException(\"TileMatrixSet not found by identifier: \" + tile.getGridSetId()); } // FIXME: 2024/5/10 éœ€è¦åœ¨metadataä¸­ç»™featureLayeræŒ‡å®šcoverage, å¯ä»¥é€‰æ‹©ä»æ•°æ®æºè¯»å–æˆ–è€…æ˜¯è‡ªè¡Œè®¾å®š(æ›´æ¨èè‡ªè¡Œè®¾å®š, æ€§èƒ½å‹å¥½ä¸”æ›´é€šç”¨) final TileMatrixSubset gridSubset = tile.getGridSubset(); if (gridSubset == null) { throw new IllegalArgumentException(\"Requested gridset not found: \" + tile.getRequest().getSchema()); } final long[] gridLoc = tile.getTileIndex(); checkNotNull(gridLoc); // Final preflight check, throws OutsideCoverageException if necessary gridSubset.checkCoverage(gridLoc); // FIXME: 2024/5/10 æš‚æ—¶ä¸å¯¹meta tilesåšæ”¯æŒ int metaX; int metaY; if (tile.getMimeType().supportsTiling()) { metaX = getMetaTilingFactors()[0]; metaY = getMetaTilingFactors()[1]; } else { metaX = metaY = 1; } ConveyorTile tileResponse; if (tile.getStorageBroker() == null) { tileResponse = getNonCachedTile(tile); }else { tileResponse = getTileResponse(tile, true, true, metaX, metaY); } // sendTileRequestedEvent(returnTile); return tileResponse; } public ConveyorTile getNonCachedTile(ConveyorTile tile) throws GeoAtlasCacheException { try { return getTileResponse(tile, false, false, 1, 1); } catch (IOException e) { throw new GeoAtlasCacheException(e); } } @Override public void seedTile(ConveyorTile tile, boolean tryCache) throws GeoAtlasCacheException, IOException { // Ignore a seed call on a tile that's outside the cached grid levels range // å¿½ç•¥ç¼“å­˜ç½‘æ ¼çº§åˆ«èŒƒå›´ä¹‹å¤–çš„å›¾å—ä¸Šçš„ç§å­è°ƒç”¨ final TileMatrixSubset subset = tile.getGridSubset(); final int zLevel = (int) tile.getTileIndex()[2]; if (!subset.shouldCacheAtZoom(zLevel)) { if (log.isDebugEnabled()) { log.debug( \"Ignoring seed call on tile \" + tile + \" as it's outside the cacheable zoom level range\"); } return; } int metaX = getMetaTilingFactors()[0]; int metaY = getMetaTilingFactors()[1]; if (!tile.getMimeType().supportsTiling()) { metaX = metaY = 1; } getTileResponse(tile, tryCache, true, metaX, metaY); } protected ConveyorTile getTileResponse( ConveyorTile tile, final boolean tryCache, final boolean persistent, final int metaX, final int metaY) throws GeoAtlasCacheException, IOException { if (tryCache \u0026\u0026 tryCacheFetch(tile)) { return finalizeTile(tile); } TileObject target = null; TileRequest request = tile.getRequest(); LockProvider.Lock lock = null; try { /* ****************** Acquire lock ******************* */ lock = getLockProvider().getLock(buildLockKey(tile)); // got the lock on the tile, try again if (tryCache \u0026\u0026 tryCacheFetch(tile)) { log.debug(\"--\u003e {} returns cache hit for {}\", Thread.currentThread().getName(), Arrays.toString(tile.getTileIndex())); } else { log.debug(\"--\u003e {} submitting getTile request for tile matrix location on {}\", Thread.currentThread().getName(), Arrays.toString(tile.getTileIndex())); long requestTime = System.currentTimeMillis(); try { FeatureSourceConveyor wrapper = featureSourceHelper.getFeatureSource(request.getNamespace(), request.getLayer()); Pyramid pyramid = findPyramid(request, wrapper.getRules()); target = pyramid.getTile(request, wrapper.getFeatureSource(), wrapper.getCrs()); // æ­¤å¤„ä¾¿å®Œæˆäº†ç“¦ç‰‡æ•°æ®å¯¹è±¡åˆ°ç“¦ç‰‡ç¼“å­˜çš„è½¬æ¢ transferTile(target, tile, requestTime, persistent); }catch (Exception e) { Throwables.throwIfInstanceOf(e, GeoAtlasCacheException.class); throw new GeoAtlasCacheException(\"Problem communicating with GeoAtlas TileAPI\", e); } } } finally { if (lock != null) { lock.release(); } } return finalizeTile(tile); } ... } å®ç°TileMatrixSubsetæ‹“å±•\n@Component @ConditionalOnBean(TileBreeder.class) public class SimpleTileSeedService extends AbstractTileSeedService { private final FeatureTileMatrixSubsetContext subsetContext; private final FeatureSourceHelper featureSourceHelper; public SimpleTileSeedService(TileBreeder breeder, FeatureTileMatrixSubsetContext subsetContext, FeatureSourceHelper featureSourceHelper) { super(breeder); this.subsetContext = subsetContext; this.featureSourceHelper = featureSourceHelper; } @Override protected TileMatrixSubset getSubset(SeedRequest request, TileMatrixSet matrixSet) throws GeoAtlasCacheException { NamespaceInfo namespaceInfo = featureSourceHelper.getNamespaceInfo(request.getNamespace()); if (namespaceInfo == null) { throw new GeoAtlasCacheException(\"namespace not found\"); } FeatureLayerInfo featureLayerInfo = featureSourceHelper.getFeatureLayerInfo(request.getNamespace(), request.getLayerName(), namespaceInfo); if (featureLayerInfo == null){ throw new GeoAtlasCacheException(\"layer not found\"); } return subsetContext.getTileMatrixSubset(featureLayerInfo, matrixSet); } } ç¼“å­˜é…ç½®ï¼ˆæ­¤é…ç½®æ¥è‡ªäºï¼šgeoatlas-tile-instanceï¼‰ï¼Œå¹¶æœªå±•ç¤ºå‡ºå…¨éƒ¨é…ç½®å†…å®¹\ngeo-atlas: cache: enabled: true inner-caching-enabled: true persistence-enabled: true # é»˜è®¤æ˜¯file-system inner: storage: eviction-policy: EXPIRE_AFTER_ACCESS memory-limit: 256 persistence: storage: base-directory: ${PERSISTENCE_CACHE_DIR:/tmp/gac} ",
  "wordCount" : "1316",
  "inLanguage": "en",
  "datePublished": "2024-07-13T15:23:18+08:00",
  "dateModified": "2024-07-13T15:23:18+08:00",
  "author":{
    "@type": "Person",
    "name": "Fuyi"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://fuyi-atlas.github.io/posts/gis/what-is-gac/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Fuyi Atlas",
    "logo": {
      "@type": "ImageObject",
      "url": "https://fuyi-atlas.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://fuyi-atlas.github.io/" accesskey="h" title="Fuyi Atlas (Alt + H)">Fuyi Atlas</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://fuyi-atlas.github.io/zh/" title="Chinese"
                            aria-label="Chinese">Zh</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://fuyi-atlas.github.io/archives/" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://fuyi-atlas.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://fuyi-atlas.github.io/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://fuyi-atlas.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://fuyi-atlas.github.io/">Home</a>&nbsp;Â»&nbsp;<a href="https://fuyi-atlas.github.io/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Geo Atlas Cacheï¼Œä¸€ä¸ªç²¾ç®€çš„GWCç»„ä»¶
    </h1>
    <div class="post-meta"><span title='2024-07-13 15:23:18 +0800 CST'>July 13, 2024</span>&nbsp;Â·&nbsp;7 min&nbsp;Â·&nbsp;Fuyi

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e5%89%8d%e8%a8%80" aria-label="å‰è¨€">å‰è¨€</a></li>
                <li>
                    <a href="#%e4%bb%80%e4%b9%88%e6%98%afgac" aria-label="ä»€ä¹ˆæ˜¯GACï¼Ÿ">ä»€ä¹ˆæ˜¯GACï¼Ÿ</a></li>
                <li>
                    <a href="#gac%e7%9a%84%e5%9f%ba%e6%9c%ac%e7%90%86%e5%bf%b5" aria-label="GACçš„åŸºæœ¬ç†å¿µ">GACçš„åŸºæœ¬ç†å¿µ</a></li>
                <li>
                    <a href="#gac%e7%9a%84%e8%ae%be%e8%ae%a1%e4%b8%8e%e5%ae%9e%e7%8e%b0" aria-label="GACçš„è®¾è®¡ä¸å®ç°">GACçš„è®¾è®¡ä¸å®ç°</a><ul>
                        
                <li>
                    <a href="#gac%e7%9a%84%e9%9c%80%e6%b1%82%e4%b8%8e%e8%ae%be%e8%ae%a1" aria-label="GACçš„éœ€æ±‚ä¸è®¾è®¡">GACçš„éœ€æ±‚ä¸è®¾è®¡</a></li>
                <li>
                    <a href="#gac%e7%9a%84%e5%ae%9e%e7%8e%b0" aria-label="GACçš„å®ç°">GACçš„å®ç°</a><ul>
                        
                <li>
                    <a href="#blobstore" aria-label="BlobStore">BlobStore</a></li>
                <li>
                    <a href="#seedreseedtruncate" aria-label="Seedã€Reseed&amp;Truncate">Seedã€Reseed&amp;Truncate</a></li>
                <li>
                    <a href="#tilematrixsubset%e6%8b%93%e5%b1%95" aria-label="TileMatrixSubsetæ‹“å±•">TileMatrixSubsetæ‹“å±•</a></li>
                <li>
                    <a href="#%e5%bf%ab%e9%80%9f%e9%9b%86%e6%88%90" aria-label="å¿«é€Ÿé›†æˆ">å¿«é€Ÿé›†æˆ</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e5%b0%8f%e7%bb%93" aria-label="å°ç»“">å°ç»“</a></li>
                <li>
                    <a href="#%e5%8f%82%e8%80%83" aria-label="å‚è€ƒ">å‚è€ƒ</a></li>
                <li>
                    <a href="#%e9%99%84%e5%bd%95" aria-label="é™„å½•">é™„å½•</a><ul>
                        
                <li>
                    <a href="#gac%e7%9a%84%e9%9b%86%e6%88%90%e7%a4%ba%e4%be%8b" aria-label="GACçš„é›†æˆç¤ºä¾‹">GACçš„é›†æˆç¤ºä¾‹</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="å‰è¨€">å‰è¨€<a hidden class="anchor" aria-hidden="true" href="#å‰è¨€">#</a></h2>
<p>ç“¦ç‰‡ç¼“å­˜ç»„ä»¶æ˜¯ç»å¤§éƒ¨åˆ†ç“¦ç‰‡æœåŠ¡æ‰€åº”è¯¥æœ‰çš„æ¨¡å—ä¹‹ä¸€ï¼Œè€Œ<a href="https://github.com/geoatlas-cloud/geo-atlas">Geo Atlas</a>åŒæ ·å®ç°äº†å…¶ç“¦ç‰‡ç¼“å­˜æ¨¡å—ã€‚æœ¬æ–‡ç”¨äºæè¿°Geo Atlasä¸­çš„Cacheæ¨¡å—çš„è®¾è®¡ä¸å®ç°è¿‡ç¨‹ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯gac">ä»€ä¹ˆæ˜¯GACï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#ä»€ä¹ˆæ˜¯gac">#</a></h2>
<p>GACï¼Œå…¨ç§°æ˜¯Geo Atlas Cacheï¼Œæ˜¯Geo Atlasç±»åº“ä¸­çš„Cacheæ¨¡å—ï¼Œç”¨äºæä¾›çŸ¢é‡ç“¦ç‰‡çš„ç¼“å­˜åŠŸèƒ½ã€‚GACæºè‡ªGWCï¼ˆGeoWebCacheï¼‰ï¼Œæ˜¯åœ¨GWCçš„åŸºç¡€ä¸Šè¿›è¡Œäº†é€‚åº”æ€§çš„è°ƒæ•´è€Œæ¥ã€‚ç›®å‰æ”¯æŒåŸºäºå†…å­˜ã€æ–‡ä»¶ç³»ç»Ÿä¸¤ç§ç¼“å­˜æ–¹å¼ï¼Œä¸”æ­¤ä¸¤ç§ç¼“å­˜æ–¹å¼å¯ä»»æ„ç»„åˆã€‚å¯¹äºç“¦ç‰‡ç¼“å­˜å¤„ç†ç­–ç•¥ï¼Œç›®å‰æ”¯æŒSeedã€Reseedã€Truncateä¸‰ç§ï¼Œä¸GWCä¿æŒä¸€è‡´ã€‚</p>
<h2 id="gacçš„åŸºæœ¬ç†å¿µ">GACçš„åŸºæœ¬ç†å¿µ<a hidden class="anchor" aria-hidden="true" href="#gacçš„åŸºæœ¬ç†å¿µ">#</a></h2>
<p>GWCä¸­å£°æ˜å¹¶å¼ºè°ƒTileLayerçš„æ¦‚å¿µï¼Œå¹¶åŸºäºæ­¤æŠ½è±¡ï¼Œç”¨ä»¥é€‚é…æ•°æ®æ¥æºä¸ç“¦ç‰‡å­˜å‚¨ï¼ˆç¼“å­˜ï¼‰ã€‚ä¹Ÿå°±å¦‚åŒGeoServerä¸­ï¼Œä¸€ä¸ªå›¾å±‚å¦‚æœéœ€è¦æ‹¥æœ‰ç¼“å­˜èƒ½åŠ›ï¼Œé‚£ä¹ˆè¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªTileLayerï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªæ‹¥æœ‰ç¼“å­˜çš„å›¾å±‚ï¼Œå°†ä¼šåŒæ—¶æŒæœ‰ä¸¤ä¸ªLayerï¼Œä¸€ä¸ªæ˜¯ Map Layerï¼ˆFeatureTypeï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯TileLayerã€‚ TileLayerä¸­è¿›è¡Œç“¦ç‰‡å­˜å‚¨ç›¸å…³å†…å®¹çš„é…ç½®ï¼Œå¯ä»¥éšæ„é…ç½®å­˜å‚¨å®¹å™¨å¯¹è±¡ï¼ˆæ–‡ä»¶ç³»ç»Ÿã€å¯¹è±¡å­˜å‚¨ã€æ•°æ®åº“ç­‰ï¼‰ã€‚</p>
<p>è€Œç›®å‰Geo Atlas Cacheçš„å®ç°åˆ™å°†å¤§å¤§ç®€åŒ–è¿™ä¸€æ“ä½œï¼Œæ²¡æœ‰TileLayerå¯¹è±¡ï¼Œå…¨å±€å…±ç”¨åŒä¸€ä¸ªå­˜å‚¨å®¹å™¨å¯¹è±¡ï¼Œæ— éœ€ç¹ççš„å­˜å‚¨é…ç½®ï¼Œé€šè¿‡è‡ªåŠ¨è£…é…å¿«é€Ÿå¯ç”¨ç¼“å­˜ï¼Œæˆ‘è®¤ä¸ºè¿™æ˜¯ä¸­å°é¡¹ç›®ä¸­æ‰€éœ€è¦çš„ã€‚</p>
<p>ç›®å‰å¯¹äºç“¦ç‰‡ç¼“å­˜ï¼ˆTile Cacheï¼‰çš„æ¸…ç†ï¼Œä¹Ÿå°±æ˜¯åŒGWCä¸­æä¾›çš„Seedã€Reseedã€Truncateä¸€èˆ¬ã€‚Truncateåªéœ€æŒæœ‰BlobStoreçš„å¥æŸ„å³å¯å®Œæˆï¼Œä½†Seedå’ŒReseedåˆ™éœ€å‰å¾€æ•°æ®çš„æºç«¯è·å–ç“¦ç‰‡ï¼Œè¿›è€Œæ‰å¯å®Œæˆæ“ä½œï¼Œä¹Ÿå°±æ˜¯éœ€è¦æŒæœ‰è·å–æºç«¯ç“¦ç‰‡Generateçš„å¥æŸ„æ‰å¯ã€‚æˆ–è®¸è¿™å°±æ˜¯ä¸ºä»€ä¹ˆGWCä¸­æå‡ºTileLayerçš„åŸå› ä¹‹ä¸€ä¹Ÿæœªå¯çŸ¥ ğŸ˜®ã€‚ ä¸è¿‡ï¼Œæˆ‘å´ç”±æ­¤è®¤ä¸ºGWCçš„è¾¹ç•Œä¸æ¸…æ™°ï¼Œæˆ‘è®¤ä¸ºç¼“å­˜å°±åšç¼“å­˜çš„äº‹æƒ…å°±å¯ä»¥äº†ï¼Œåº”å½“æŠŠLayerã€TileMatrixSetï¼ˆGridSetï¼‰å’ŒCacheåˆ†å¼€ã€‚ä½†å¦‚æ­¤ï¼Œè‹¥æƒ³è¦æ”¯æŒSeedå’ŒReseedè¿™ä¸¤ç§ç»™ç­–ç•¥çš„è¯ï¼Œè‡³å°‘éœ€è¦æä¾›ä¸€ä¸ªæ‹“å±•ç‚¹æ‰å¯ã€‚æˆ‘åœ¨æ­¤å°†å…¶å‘½åä¸ºTileSourceï¼Œæ˜¯ä¸ºCacheä¸Sourceï¼ˆæºç«¯ç“¦ç‰‡ï¼‰ä¹‹é—´çš„é€‚é…ç»„ä»¶ã€‚å…¶å®ï¼Œè¿™ä¸ä¹Ÿæ˜¯ä¸€ç§ç­‰åŒTileLayerçš„å­˜åœ¨ï¼Œä½†æˆ‘å¹¶ä¸é€šè¿‡Layeræ¥è¿›è¡Œå…³è”æ§åˆ¶ï¼Œä¹Ÿæ²¡æœ‰TileLayerçš„æ¦‚å¿µï¼Œç¼“å­˜å°±æ˜¯ç¼“å­˜ã€‚</p>
<h2 id="gacçš„è®¾è®¡ä¸å®ç°">GACçš„è®¾è®¡ä¸å®ç°<a hidden class="anchor" aria-hidden="true" href="#gacçš„è®¾è®¡ä¸å®ç°">#</a></h2>
<p>å› ä¸ºGeoServeræ²‰é‡çš„å†å²åŒ…è¢±ä»¥åŠå¤§è€Œå…¨çš„è‡ƒè‚¿ï¼Œæ‰€ä»¥æœ‰äº†Geo Atlasé¡¹ç›®ã€‚GACä¹Ÿå°†å»¶ç»­æ­¤ç†å¿µï¼Œå»é™¤Cacheç‰¹å®šäºLayerçš„æ¦‚å¿µï¼Œæ— éœ€ä¸ºå›¾å±‚å•ç‹¬é…ç½®ç¼“å­˜ï¼Œå› ä¸ºç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ä½¿ç”¨ç›¸åŒçš„ç¼“å­˜é…ç½®ã€‚åŒæ—¶ï¼Œä»–åº”è¯¥æ˜¯å¯ä»¥è¢«å¿«é€Ÿé›†æˆï¼Œä¸”æ˜“äºé…ç½®çš„ã€‚ä¸ºäº†æå‡ç¼“å­˜ç»„ä»¶çš„æ˜“ç”¨æ€§ã€å…¼å®¹æ€§åŠç¨³å®šæ€§ï¼Œè‡³å°‘åº”è¯¥æä¾›ä¸¤ç§ä¸åŒçš„ç¼“å­˜å­˜å‚¨å¯¹è±¡ï¼Œä¸”å…¶ä¸­ä¸€ç§åº”è¯¥æ˜¯åŸºäºå†…å­˜çš„ï¼Œå¦å¤–ä¸€ç§æ˜¯æ”¯æŒæŒä¹…åŒ–çš„ã€‚å½“æ•°æ®é‡å¾ˆå°‘æ—¶ï¼Œå¯ä»¥å…³é—­ç¼“å­˜æˆ–ä»…å¼€å¯å†…å­˜ç¼“å­˜ï¼›å½“æ•°æ®é‡è¾ƒå¤§æ—¶ï¼Œå¯ä»¥ä»…å¼€å¯æŒä¹…åŒ–ç¼“å­˜æˆ–åŒæ—¶å¼€å¯å†…å­˜ç¼“å­˜ã€‚å†…å­˜ç¼“å­˜ä¸å¯æŒä¹…åŒ–ç¼“å­˜å¯è‡ªç”±æ­é…ï¼Œä»»æ„ç»„åˆã€‚å½“ä¸¤è€…å…¨å¼€å¯æ—¶ï¼Œå¯å½¢æˆä¸¤çº§ç¼“å­˜ï¼Œæ­¤æ—¶éœ€æ³¨æ„ä¸¤çº§ç¼“å­˜é—´æ•°æ®çš„åŒæ­¥ã€‚</p>
<h3 id="gacçš„éœ€æ±‚ä¸è®¾è®¡">GACçš„éœ€æ±‚ä¸è®¾è®¡<a hidden class="anchor" aria-hidden="true" href="#gacçš„éœ€æ±‚ä¸è®¾è®¡">#</a></h3>
<p>æ¥ä¸‹æ¥ï¼Œå†æ¬¡ç¡®å®šä¸€ä¸‹GACçš„éœ€æ±‚ï¼š</p>
<ul>
<li>æ”¯æŒçŸ¢é‡ç“¦ç‰‡ç¼“å­˜</li>
<li>æä¾›ä¸¤ç±»ç¼“å­˜å­˜å‚¨å¯¹è±¡ï¼Œå…¶ä¸­ä¸€ç§åº”è¯¥æ˜¯åŸºäºå†…å­˜çš„ï¼Œå¦å¤–ä¸€ç§æ˜¯æ”¯æŒæŒä¹…åŒ–çš„ï¼Œä¸”ä¸¤è€…å¯ä»»æ„ç»„åˆï¼ŒåŒæ—¶å¼€å¯å¯å½¢æˆäºŒçº§ç¼“å­˜ç»“æ„</li>
<li>æä¾›Seedã€Reseedã€Truncateæ­¤ä¸‰ç§ç“¦ç‰‡ç¼“å­˜æ¸…ç†ç­–ç•¥</li>
<li>å…¨å±€å…±ç”¨åŒä¸€ä¸ªç¼“å­˜å­˜å‚¨å¯¹è±¡ï¼Œæä¾›å¿«é€Ÿé›†æˆèƒ½åŠ›</li>
</ul>
<p>å…¶ä¸­ï¼ŒäºŒçº§ç¼“å­˜æ˜¯æ­¤å‰æ²¡æœ‰æ¥è§¦è¿‡çš„å†…å®¹ã€‚ç»“åˆè‡ªæˆ‘è‡†æƒ³ï¼Œç»™å‡ºäº†å¦‚ä¸‹è®¾æƒ³ ğŸ«£ï¼š</p>
<p>æ­¤äºŒçº§ç¼“å­˜ï¼Œå¯è‡ªè¡Œç¡®å®šç»„åˆæ–¹å¼ï¼Œå¹¶ééœ€è¦ä¸¤è€…åŒæ—¶å¼€å¯ã€‚éš¾ç‚¹ï¼šçŠ¶æ€åŒæ­¥ï¼ˆæ•°æ®ä¸€è‡´æ€§ï¼‰</p>
<ul>
<li>ä¸€çº§ç¼“å­˜ï¼ˆåŸºäºå†…å­˜ï¼‰ï¼š Local Mem Cache + LRU
<ul>
<li>Guava</li>
<li>Caffeine</li>
</ul>
</li>
<li>äºŒçº§ç¼“å­˜ï¼ˆå¯æŒä¹…åŒ–ï¼‰ï¼šOuter Cache
<ul>
<li>Redis</li>
<li>File System</li>
<li>Database
<ul>
<li>GeoPackage
<ul>
<li>æ¯ä¸€ä¸ªLevelä¸€ä¸ªgpkgæ–‡ä»¶ï¼Œæå‡å¹¶å‘è¯»å†™èƒ½åŠ›ï¼ˆæ”¯æŒé…ç½®ä¸ºæ‰€æœ‰Levelç”¨ä¸€ä¸ªgpkgï¼Œä½†æ˜¯ä¸æ¨èï¼‰</li>
</ul>
</li>
<li>PostGIS</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>ä¸è¿‡ï¼Œåœ¨ç»è¿‡ä¸€ç•ªè°ƒç ”ä¹‹åï¼Œè¿˜æ˜¯å†³å®šæŠ„GeoWebCacheçš„ä½œä¸š ğŸ˜§ã€‚ä¸€æ˜¯ç¡®å®æœ‰ä¸€å®šçš„éš¾åº¦ï¼ŒäºŒæ˜¯ç›®å‰æ—¶é—´æœ‰é™ï¼ŒGAPä¸­çš„æˆ‘æ—©å·²ç‘Ÿç‘Ÿå‘æŠ– ğŸ™„ã€‚æœ€é‡è¦çš„æ˜¯ï¼ŒGeoWebCacheä¸­çš„<code>MemoryBlobStore</code>å·²ç»å®ç°äº†ä¸Šè¿°äºŒçº§ç¼“å­˜çš„éœ€æ±‚å‘€ ğŸ«¡ï¼Œå¦‚æ­¤æ“ä½œå¯ç›´æ¥è¦†ç›–æ‰å‰ä¸‰ä¸ªéœ€æ±‚ã€‚è€Œæ­¤æ—¶äºŒçº§ç¼“å­˜çš„å®ç°ç¡®å®šä¸ºï¼š</p>
<ul>
<li>åŸºäºå†…å­˜çš„ç¼“å­˜ï¼ˆGuavaï¼‰</li>
<li>åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„ç¼“å­˜</li>
</ul>
<p>éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œæ­¤<code>MemoryBlobStore</code>äºŒçº§ç¼“å­˜æ˜¯å¯æ‹“å±•æ¶æ„ï¼Œåç»­å¯è‡ªè¡Œæ‹“å±•ä¸åŒçš„Providerã€‚</p>
<blockquote>
<p>ğŸ’¡ å¯¹äºSeedä¸Reseedçš„å¤„ç†ï¼Œåˆ™ä¸GACçš„ç†å¿µä¸­æ‰€è¿°ä¸€è‡´ï¼Œé€šè¿‡TileSourceå¯¹å¤–æä¾›æ‹“å±•ã€‚ä¹Ÿå°±æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼ŒCacheæ¨¡å—åªæä¾›Seedä¸Reseedçš„å£°æ˜ï¼Œæ— æ³•æä¾›å…·ä½“å®ç°ï¼ˆæ— æ³•ç›´æ¥ä¸Sourceè¿›è¡Œé“¾æ¥ï¼‰ã€‚</p>
</blockquote>
<p>é‚£ä¹ˆæ­¤åˆ»åªå‰©ä¸‹æœ€åä¸€ä¸ªéœ€æ±‚äº†ï¼Œå…¶ä¸»æ—¨å›´ç»•å¿«é€Ÿé…ç½®ã€æ˜“ç”¨ã€‚åœ¨æ­¤åŸºäºGeoWebCacheä¸­çš„<code>DefaultStorageBroker</code> ç±»è¿›è¡Œç¼“å­˜å­˜å‚¨å¯¹è±¡çš„ä»£ç†ï¼Œå…¶ç¬¦åˆGWCä¸­ç¼“å­˜å­˜å‚¨å¯¹è±¡è®¾è®¡æ¶æ„ï¼Œä¹Ÿä¸ºåç»­æä¾›äº†æ›´å¤šçš„æ‹“å±•ç‚¹ï¼ŒåŒæ—¶å°†å…¶æš´éœ²ç»™å…¨å±€ï¼Œå³å…¨å±€å…±ç”¨çš„ç¼“å­˜å­˜å‚¨å¯¹è±¡ã€‚å¯¹äºå¿«é€Ÿé›†æˆèƒ½åŠ›ï¼Œæ­¤å¤„å°†ç»“åˆSpring Bootçš„<code>AutoConfiguration</code>ç‰¹æ€§ï¼Œä¸ºGACæä¾›è‡ªåŠ¨è£…é…èƒ½åŠ›ã€‚ä¸æ­¤åŒæ—¶ï¼Œå°†ç¼“å­˜å­˜å‚¨å¯¹è±¡çš„å¯è®¾ç½®å±æ€§é€šè¿‡é…ç½®çš„æ–¹å¼æš´éœ²å‡ºæ¥ï¼Œå¯ç›´æ¥åœ¨<code>application.yml</code>æˆ–<code>application.properties</code>ä¸­è¿›è¡Œé…ç½®ã€‚å…·ä½“å¯é…ç½®å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li>geo-atlas.cache.enabled=falseï¼ˆæ˜¯å¦å¯ç”¨ç¼“å­˜ï¼Œé»˜è®¤ä¸ºfalseï¼‰</li>
</ul>
<hr>
<ul>
<li>
<p>geo-atlas.cache.inner-caching-enabled=falseï¼ˆæ˜¯å¦å¯ç”¨å†…å­˜ç¼“å­˜ï¼Œé»˜è®¤ä¸ºfalseï¼‰</p>
</li>
<li>
<p>geo-atlas.cache.inner.storage.provider=guavaï¼ˆå¯é€‰å€¼ï¼šguavaï¼Œæš‚ä¸æ”¯æŒï¼Œä¿ç•™ï¼‰</p>
</li>
<li>
<p>geo-atlas.cache.inner.storage.memory-limit=16ï¼ˆå†…å­˜å¤§å°é™åˆ¶ï¼Œå•ä½MBï¼Œé»˜è®¤16ï¼‰</p>
</li>
<li>
<p>geo-atlas.cache.inner.storage.concurrency-level=4ï¼ˆç¼“å­˜å¹¶å‘çº§åˆ«çš„é»˜è®¤å€¼ï¼Œé»˜è®¤ä¸º4ï¼‰</p>
</li>
<li>
<p>geo-atlas.cache.inner.storage.eviction-policy=nullï¼ˆç¼“å­˜é©±é€æ”¿ç­–ï¼Œå³ç¼“å­˜æ·˜æ±°ç®—æ³•ï¼Œå¯é€‰å€¼ï¼šNULLã€LRUã€LFUã€EXPIRE_AFTER_WRITEã€EXPIRE_AFTER_ACCESSï¼Œé»˜è®¤å€¼ä¸ºNULLï¼‰</p>
<blockquote>
<p>ğŸ’¡ LRUã€LFUæš‚æ—¶ä¸æ”¯æŒ</p>
</blockquote>
</li>
<li>
<p>geo-atlas.cache.inner.storage.eviction-time=2*60ï¼ˆç¼“å­˜é©±é€æ—¶é—´çš„é»˜è®¤å€¼ï¼Œå•ä½ï¼šç§’ï¼Œé»˜è®¤ï¼š2 minutesï¼‰</p>
</li>
</ul>
<hr>
<ul>
<li>geo-atlas.cache.persistence-enabled=falseï¼ˆæ˜¯å¦å¯ç”¨æŒä¹…åŒ–ç¼“å­˜ï¼Œé»˜è®¤ä¸ºfalseï¼‰</li>
<li>geo-atlas.cache.persistence.storage.provider=file-systemï¼ˆæŒä¹…åŒ–ç¼“å­˜å­˜å‚¨ç­–ç•¥å¯¹è±¡ï¼Œå¯é€‰å€¼ï¼šfile-systemã€geopackageï¼Œç°åªæ”¯æŒfile-systemï¼‰</li>
<li>geo-atlas.cache.persistence.storage.base-directoryï¼ˆå³æœ€ç»ˆç“¦ç‰‡æŒä¹…åŒ–çš„ç›®å½•åŸºç¡€è·¯å¾„ï¼Œé»˜è®¤è¯»å–ï¼šjava.io.tmpdirï¼Œå¯æ‹“å±•ï¼‰</li>
</ul>
<hr>
<ul>
<li>
<p>geo-atlas.cache.persistence.storage.file-system.path-generator-type=defaultï¼ˆå³ç“¦ç‰‡å­˜å‚¨è·¯å¾„ç®—æ³•ï¼Œå¯é€‰å€¼ï¼šdefaultã€tmsã€xyzï¼Œé»˜è®¤ä¸ºdefaultï¼‰</p>
</li>
<li>
<p>geo-atlas.cache.persistence.storage.fs.block-size=4096ï¼ˆThe default block size is 4096 bytes.ï¼‰</p>
<p>This setting determines how the tile cache calculates disk usage. The value for this setting should be equivalent to the disk block size of the storage medium where the cache is located. The default block size is 4096 bytes.ï¼ˆæ­¤è®¾ç½®ç¡®å®šåˆ‡ç‰‡ç¼“å­˜å¦‚ä½•è®¡ç®—ç£ç›˜ä½¿ç”¨æƒ…å†µã€‚ è¯¥è®¾ç½®çš„å€¼åº”ç­‰äºç¼“å­˜æ‰€åœ¨å­˜å‚¨ä»‹è´¨çš„ç£ç›˜å—å¤§å°ã€‚ é»˜è®¤å—å¤§å°ä¸º 4096 å­—èŠ‚ã€‚ï¼‰</p>
<blockquote>
<p>ğŸ’¡ ç›®å‰è¯¥è®¾ç½®åº”æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œæ¯•ç«Ÿåˆæ²¡åšç£ç›˜ä½¿ç”¨æƒ…å†µçš„ç»Ÿè®¡ã€‚ ğŸ¤¨</p>
</blockquote>
</li>
</ul>
<h3 id="gacçš„å®ç°">GACçš„å®ç°<a hidden class="anchor" aria-hidden="true" href="#gacçš„å®ç°">#</a></h3>
<p>æ—¢ç„¶å†³å®šæŠ„GeoWebCacheçš„ä½œä¸šï¼Œé‚£ä¸»è¦å†…å®¹å°±æ˜¯å¯¹å…¶Cacheéƒ¨åˆ†å†…å®¹è¿›è¡Œç§»æ¤ï¼ŒåŒæ—¶å°†Geo Atlasçš„å¼€æºåè®®å˜æ›´ä¸ºLGPLï¼ˆMIT â†’ LGPLï¼‰ã€‚å½“æ‰€æœ‰å†…å®¹éƒ½è¢«è‡ªæˆ‘å¸æ”¶è½¬æ¢åï¼Œå°±å¯ä»¥è‡ªç”±æ§åˆ¶åè®®äº†ï¼Œæ¯”å¦‚å†è½¬ä¸ºMITæˆ–Apacheã€‚</p>
<p><img loading="lazy" src="https://zhou-fuyi.github.io/picx-images-hosting/gac-1.7sn3jfycfh.webp" alt="gac-1"  />
</p>
<h4 id="blobstore">BlobStore<a hidden class="anchor" aria-hidden="true" href="#blobstore">#</a></h4>
<p>è¿™é‡Œå¯ä»¥å…ˆçœ‹ä¸€ä¸‹<code>BlobStore</code>çš„ç°æœ‰ç»“æ„è®¾è®¡ï¼Œ<code>BlobStore</code>æ˜¯ç¼“å­˜å­˜å‚¨å¯¹è±¡çš„é¡¶å±‚æ¥å£ï¼Œ<code>MemoryBlobStore</code>ã€<code>FileBlobStore</code>ã€<code>NullBlobStore</code>ç­‰å‡æ˜¯<code>BlobStore</code>çš„å…·ä½“å®ç°ã€‚è¿™é‡Œå¯ä»¥æ³¨æ„åˆ°<code>MemoryBlobStore</code>ä¸­æœ‰ä¸€ä¸ª<code>store</code>å±æ€§ï¼ˆç±»å‹ä¸º<code>BlobStore</code>ï¼‰å’Œä¸€ä¸ª<code>cacheProvider</code>å±æ€§ï¼ˆç±»å‹ä¸º<code>CacheProvider</code>ï¼‰ï¼Œè¿™ä¹Ÿå°±æ˜¯å‰é¢æåˆ°çš„äºŒçº§ç¼“å­˜å®ç°ã€‚</p>
<p><img loading="lazy" src="https://zhou-fuyi.github.io/picx-images-hosting/BlobStore.5j42zydlyn.webp" alt="BlobStore"  />
</p>
<p>å±•å¼€<code>MemoryBlobStore</code>ï¼Œå¯ä»¥ä»å…¶æ„é€ å‡½æ•°å‘ç°ï¼Œé»˜è®¤æƒ…å†µä¸‹åªæä¾›äº†åŸºäºGuavaçš„å†…å­˜ç¼“å­˜ï¼ŒåŒ…è£…çš„<code>BlobStore</code>æ˜¯ä¸€ä¸ªç©ºå®ç°ï¼Œä¸”åœ¨æ­¤å¤„æ³¨é‡Šï¼Œå‘ŠçŸ¥å…¶é»˜è®¤è¡Œä¸ºå’Œæç¤ºçš„æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒ…è£…çš„<code>BlobStore</code>å®ä¾‹å¯¹è±¡å¯ä»¥æ˜¯<code>BlobStore</code>æ¥å£çš„ä»»æ„å®ç°ï¼Œæˆ‘åœ¨æ­¤å°†ä½¿ç”¨åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„å®ç°ï¼ˆ<code>FileBlobStore</code>ï¼‰è¿›è¡Œå¡«å……ã€‚</p>
<p><img loading="lazy" src="https://zhou-fuyi.github.io/picx-images-hosting/gac-2.839xcldkkq.webp" alt="gac-2"  />
</p>
<p>æœ€ç»ˆï¼Œå°†äºŒçº§ç¼“å­˜æ„å»ºçš„æ•´ä½“é€»è¾‘ç»“åˆå¯é…ç½®æ€§å°è£…äºä¸€ä¸ªæ³¨å†Œç±»ä¸­ï¼Œåœ¨æ­¤å°†å…¶å‘½åä¸ºï¼š<code>StorageBrokerRegister</code>ï¼Œæ­¤å³ä¸ºå…¨å±€å…±ç”¨çš„ç¼“å­˜å­˜å‚¨å¯¹è±¡ï¼Œä¸»è¦ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">StorageBrokerRegister</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">EnvironmentAware</span><span class="p">,</span><span class="w"> </span><span class="n">ImportBeanDefinitionRegistrar</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">StorageBrokerRegister</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">FILE_SYSTEM_PROVIDER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;file-system&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">GEO_PACKAGE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;geo-package&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Environment</span><span class="w"> </span><span class="n">environment</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">DefaultStorageFinder</span><span class="w"> </span><span class="n">storageFinder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DefaultStorageFinder</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setEnvironment</span><span class="p">(</span><span class="n">Environment</span><span class="w"> </span><span class="n">environment</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">environment</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">registerBeanDefinitions</span><span class="p">(</span><span class="n">AnnotationMetadata</span><span class="w"> </span><span class="n">importingClassMetadata</span><span class="p">,</span><span class="w"> </span><span class="n">BeanDefinitionRegistry</span><span class="w"> </span><span class="n">registry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// FIXME: 2024/5/10 å…¶å®ç›®å‰TransientCacheå¹¶æ²¡æœ‰ä»€ä¹ˆä½¿ç”¨åœºæ™¯ï¼Œä¸è¿‡æš‚æ—¶å…ˆç•™ä¸‹</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// TransientCache æ—©äºMemoryStoreå‡ºç°, å‰è€…åº”è¯¥æ˜¯2012å¹´, åè€…åº”è¯¥æ˜¯2014å¹´</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">TransientCache</span><span class="w"> </span><span class="n">transientCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TransientCache</span><span class="p">(</span><span class="n">100</span><span class="p">,</span><span class="w"> </span><span class="n">1024</span><span class="p">,</span><span class="w"> </span><span class="n">2000</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">BlobStore</span><span class="w"> </span><span class="n">blobStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NullBlobStore</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Boolean</span><span class="w"> </span><span class="n">cacheEnabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getApplicationValue</span><span class="p">(</span><span class="n">GeoAtlasCacheEnvKeys</span><span class="p">.</span><span class="na">getCacheEnabled</span><span class="p">(),</span><span class="w"> </span><span class="n">Boolean</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">Boolean</span><span class="p">.</span><span class="na">FALSE</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cacheEnabled</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Boolean</span><span class="w"> </span><span class="n">innerCachingEnabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getApplicationValue</span><span class="p">(</span><span class="n">GeoAtlasCacheEnvKeys</span><span class="p">.</span><span class="na">getInnerCachingEnabled</span><span class="p">(),</span><span class="w"> </span><span class="n">Boolean</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">Boolean</span><span class="p">.</span><span class="na">FALSE</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Boolean</span><span class="w"> </span><span class="n">persistenceEnabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getApplicationValue</span><span class="p">(</span><span class="n">GeoAtlasCacheEnvKeys</span><span class="p">.</span><span class="na">getPersistenceEnabled</span><span class="p">(),</span><span class="w"> </span><span class="n">Boolean</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">Boolean</span><span class="p">.</span><span class="na">FALSE</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">innerCachingEnabled</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">MemoryBlobStore</span><span class="w"> </span><span class="n">memoryBlobStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buildInnerCache</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">persistenceEnabled</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">memoryBlobStore</span><span class="p">.</span><span class="na">setStore</span><span class="p">(</span><span class="n">buildPersistenceCache</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">blobStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">memoryBlobStore</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">persistenceEnabled</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">blobStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buildPersistenceCache</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">log</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&#34;The cache configuration can be turned on, but the memory cache and persistent cache are turned off and cannot be further configured.&#34;</span><span class="w"> </span><span class="o">+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="s">&#34; Please check your configuration items.&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">log</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&#34;This blobStore configuration fails and will enter a no-cache state.&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">BeanDefinitionBuilder</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BeanDefinitionBuilder</span><span class="p">.</span><span class="na">genericBeanDefinition</span><span class="p">(</span><span class="n">DefaultStorageBroker</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">builder</span><span class="p">.</span><span class="na">addConstructorArgValue</span><span class="p">(</span><span class="n">blobStore</span><span class="p">).</span><span class="na">addConstructorArgValue</span><span class="p">(</span><span class="n">transientCache</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">AbstractBeanDefinition</span><span class="w"> </span><span class="n">beanDefinition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="na">getBeanDefinition</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">beanDefinition</span><span class="p">.</span><span class="na">setSynthetic</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">registerBeanDefinition</span><span class="p">(</span><span class="s">&#34;storageBroker&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">beanDefinition</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;The BlobStore registration is complete&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="seedreseedtruncate">Seedã€Reseed&amp;Truncate<a hidden class="anchor" aria-hidden="true" href="#seedreseedtruncate">#</a></h4>
<p>å¯¹äºTruncateæ¥è¯´ï¼Œç›´æ¥è¿›è¡Œå…¨é¢ç§»æ¤å³å¯ã€‚ç”±äºæ­¤å¤„ç§»é™¤äº†TileLayeræ¦‚å¿µï¼Œæ‰€ä»¥Seedä¸Reseedæ— æ³•å…¨é¢ç§»æ¤å¤„ç†ï¼Œè€Œæ˜¯ä»…ç§»æ¤å…¶æœ€ç»ˆå®ç°éƒ¨åˆ†ï¼Œå¯¹äºè¿™ä¸¤è€…ä¸æºç«¯ç“¦ç‰‡çš„é“¾æ¥åˆ™é€šè¿‡<code>TileSource</code>æ¥å£æ¥å®ç°ã€‚å³é»˜è®¤æƒ…å†µä¸‹ï¼ŒGACæ— æ³•æä¾›å®Œæ•´çš„Seedä¸ReseedåŠŸèƒ½ï¼Œéœ€è¦æ¥å…¥ç«¯å®ç°<code>TileSource</code>ä¸­çš„<code>seedTile</code>æ–¹æ³•ï¼ŒGACä¸­ä»…æä¾›ä¸€ä¸ª<code>TileSource</code>çš„ç©ºå®ç°ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">TileSource</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * å³é»˜è®¤ä¸ä½¿ç”¨MetaTiles
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="n">META_TILING_FACTORS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">1</span><span class="p">,</span><span class="n">1</span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * The size of a metatile in tiles.
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return the {x,y} metatiling factors
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">default</span><span class="w"> </span><span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="nf">getMetaTilingFactors</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">META_TILING_FACTORS</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">seedTile</span><span class="p">(</span><span class="n">ConveyorTile</span><span class="w"> </span><span class="n">tile</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">tryCache</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">throws</span><span class="w"> </span><span class="n">GeoAtlasCacheException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">abstract</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AbstractTileSource</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">TileSource</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">getClass</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ThreadLocal</span><span class="o">&lt;</span><span class="n">ByteArrayResource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">TILE_BUFFER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadLocal</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">seedTile</span><span class="p">(</span><span class="n">ConveyorTile</span><span class="w"> </span><span class="n">tile</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">tryCache</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">throws</span><span class="w"> </span><span class="n">GeoAtlasCacheException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Cacheæ¨¡å—æ— æ³•è‡ªä¸»æ‰§è¡Œseed&amp;reseedæ“ä½œï¼Œéœ€è¦é›†æˆæ–¹è‡ªè¡Œå®ç°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">log</span><span class="p">.</span><span class="na">isWarnEnabled</span><span class="p">()){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&#34;The Cache module cannot perform seed &amp; reseed operations autonomously, and the integrator needs to implement it by itself.&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">transferTile</span><span class="p">(</span><span class="n">TileObject</span><span class="w"> </span><span class="n">tile</span><span class="p">,</span><span class="w"> </span><span class="n">ConveyorTile</span><span class="w"> </span><span class="n">tileProto</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">requestTime</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">persistent</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">GeoAtlasCacheException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ByteArrayResource</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">getTileBuffer</span><span class="p">(</span><span class="n">TILE_BUFFER</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// copy resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">tileProto</span><span class="p">.</span><span class="na">setBlob</span><span class="p">(</span><span class="n">resource</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">writeTileToStream</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span><span class="w"> </span><span class="n">resource</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">tile</span><span class="p">.</span><span class="na">setCreated</span><span class="p">(</span><span class="n">requestTime</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">persistent</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">tileProto</span><span class="p">.</span><span class="na">getStorageBroker</span><span class="p">().</span><span class="na">put</span><span class="p">(</span><span class="n">tile</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">tileProto</span><span class="p">.</span><span class="na">getStorageObject</span><span class="p">().</span><span class="na">setCreated</span><span class="p">(</span><span class="n">tile</span><span class="p">.</span><span class="na">getCreated</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">StorageException</span><span class="w"> </span><span class="n">var18</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GeoAtlasCacheException</span><span class="p">(</span><span class="n">var18</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;Unable to write image tile to ByteArrayOutputStream&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">ByteArrayResource</span><span class="w"> </span><span class="nf">getTileBuffer</span><span class="p">(</span><span class="n">ThreadLocal</span><span class="o">&lt;</span><span class="n">ByteArrayResource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tl</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ByteArrayResource</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ByteArrayResource</span><span class="p">)</span><span class="w"> </span><span class="n">tl</span><span class="p">.</span><span class="na">get</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">buffer</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ByteArrayResource</span><span class="p">(</span><span class="n">16</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">1024</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">tl</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">buffer</span><span class="p">.</span><span class="na">truncate</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">buffer</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">writeTileToStream</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">TileObject</span><span class="w"> </span><span class="n">raw</span><span class="p">,</span><span class="w"> </span><span class="n">Resource</span><span class="w"> </span><span class="n">target</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">OutputStream</span><span class="w"> </span><span class="n">outStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="na">getOutputStream</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">IOUtils</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">raw</span><span class="p">.</span><span class="na">getBlob</span><span class="p">().</span><span class="na">getInputStream</span><span class="p">(),</span><span class="w"> </span><span class="n">outStream</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// GACä¸­TileSourceçš„é»˜è®¤å®ç°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DefaultTileSource</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractTileSource</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><blockquote>
<p>ğŸ’¡ è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒGWCä¸­æœ‰ä¸€ä¸ªMetatilesæŠ€æœ¯ï¼Œæ˜¯ä¸€ä¸ªé’ˆå¯¹åœ°å›¾ç“¦ç‰‡ï¼ˆPNG|JPEGï¼‰çš„ä¼˜åŒ–æŠ€æœ¯ã€‚ä½†æ˜¯åœ¨GWCç°æœ‰çš„æ¶æ„ç»„ç»‡ä¸Šï¼ŒMetatilesæ˜¯æ— æ³•æ”¯æŒçŸ¢é‡ç“¦ç‰‡æŠ€æœ¯çš„ï¼Œä¹Ÿå°±æ˜¯ä¼šè¿˜åŸä¸º1x1çš„ç»„åˆã€‚æ‰€ä»¥æˆ‘åœ¨æ­¤å¤„ç›´æ¥å°†Metatilesé»˜è®¤è®¾ç½®ä¸º1x1çš„ç»„åˆï¼ŒåŒæ—¶æš‚æ—¶å»é™¤äº†ç“¦ç‰‡è½¬å­˜éƒ¨åˆ†ä¸­Metatilesæ‹†åˆ†é€»è¾‘ã€‚</p>
</blockquote>
<h4 id="tilematrixsubsetæ‹“å±•">TileMatrixSubsetæ‹“å±•<a hidden class="anchor" aria-hidden="true" href="#tilematrixsubsetæ‹“å±•">#</a></h4>
<p>å…ˆè®²ä¸€ä¸‹å½“æŒ‡å®šBBoxåï¼ŒTruncateã€Seedã€Reseedçš„å¤§ä½“æ‰§è¡Œé€»è¾‘ã€‚GACå¯¹äºç“¦ç‰‡æ¸…ç†ç­–ç•¥çš„æ‰§è¡Œä¸GWCä¿æŒé«˜åº¦ä¸€è‡´ï¼ŒåŒæ ·æ”¯æŒæŒ‡å®šBBoxè¿›è¡Œç“¦ç‰‡æ¸…ç†ï¼ŒBBoxç”¨äºé™å®šå¯æ¸…ç†èŒƒå›´ã€‚åœ¨å‰æ–‡ä¸­å¯¹äºTileMatrixSetå’ŒTileMatrixSubsetåšè¿‡è§£é‡Šï¼Œå‰è€…ç”¨äºå®šä¹‰ç“¦ç‰‡çŸ©é˜µé›†ï¼Œåè€…ç”¨äºåœ¨ç“¦ç‰‡çŸ©é˜µé›†ä¸­æè¿°æ•°æ®çš„å®é™…èŒƒå›´ï¼ŒåŒæ—¶é™å®šç“¦ç‰‡å¯è¯·æ±‚çš„èŒƒå›´ï¼Œæ­¤ä¸¤è€…åˆ†åˆ«å¯¹åº”GWCä¸­çš„GridSetåŠGridSubsetã€‚åœ¨GWCæºå¸¦BBoxçš„ç“¦ç‰‡æ¸…ç†ç­–ç•¥æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šè·å–å¯¹åº”TileLayerçš„GridSubsetï¼Œå¹¶ä¸ç»™å®šçš„BBoxè®¡ç®—ç›¸äº¤èŒƒå›´ï¼Œè€Œåå°±å¯ä»¥ç²¾ç¡®çš„ç¡®å®šå“ªäº›ç“¦ç‰‡æ˜¯éœ€è¦è¢«æ¸…ç†çš„äº†ã€‚å¯¹äºGACæ¥è¯´ï¼Œå¹¶æ²¡æœ‰å¦‚TileLayerçš„æ¦‚å¿µï¼Œä¹Ÿæ— æ³•ä¸æºç«¯æˆ–å›¾å±‚ï¼ˆFeatureLayerï¼‰è¿›è¡Œç›´æ¥é“¾æ¥ï¼Œæ‰€ä»¥æ˜¯æ— æ³•è·å–åˆ°å›¾å±‚æ‰€æŒæœ‰çš„TileMatrixSubsetå¯¹è±¡ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚</p>
<p>å½“ç„¶ï¼Œå¹¶ä¸æ˜¯è¯´æ²¡æœ‰TileMatrixSubsetå¯¹è±¡å°±æ— æ³•è¿›è¡Œç“¦ç‰‡ç¼“å­˜çš„æ¸…ç†äº†ã€‚å°±æ‹¿æˆ‘ä»¬å®é™…åº”ç”¨ä¸­å¤§éƒ¨åˆ†åœºæ™¯æ¥è¯´ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨åŸºäºWebå¢¨å¡æ‰˜æˆ–CGCS2000ç»çº¬åº¦ç­‰é—´éš”ç›´æŠ•çš„ç“¦ç‰‡çŸ©é˜µé›†ä½œä¸ºTileMatrixSetï¼Œç”¨æ•°æ®çš„å®é™…èŒƒå›´æ„å»ºTileMatrixSubsetã€‚æ­¤æ—¶å¯è®¤ä¸ºå‰è€…ä¸ºå…¨çƒèŒƒå›´ï¼Œåè€…ä¸ºå±€éƒ¨èŒƒå›´ã€‚ä½†æ— è®ºä¸å…¨çƒèŒƒå›´è¿˜æ˜¯å±€éƒ¨èŒƒå›´è¿›è¡Œç›¸äº¤è®¡ç®—ï¼Œå…¶æœ€ç»ˆè®¡ç®—ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œéƒ½æ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œçš„ã€‚åªä¸è¿‡ç›´è§‰å‘Šè¯‰æˆ‘ï¼Œä½¿ç”¨å±€éƒ¨èŒƒå›´è®¡ç®—åº”è¯¥ä¼šæ›´å¿«ä¸€äº› ä¹Ÿæœªå¯çŸ¥å•Š ğŸ¤”ï¼ˆæˆ‘æ²¡æœ‰æ•°æ®æ”¯æŒï¼Œçº¯å±çå’§å’§ ğŸ˜›ï¼‰ï¼Œæ‰€ä»¥ç»§ç»­ç•™ä¸‹TileMatrixSubsetçš„æ‹“å±•ç‚¹ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒGACæ˜¯æ— æ³•è·å–åˆ°å›¾å±‚çš„TileMatrixSubsetå¯¹è±¡çš„ï¼Œé‚£ä¹ˆä¼šä½¿ç”¨TileMatrixSetå¯¹åº”çš„èŒƒå›´è¿›è¡ŒTileMatrixSubsetçš„æ„å»ºã€‚å¯èƒ½ä½ ä¼šé—®ï¼Œæ—¢ç„¶å¯ä»¥åœ¨å…¨å±€è·å–åˆ°TileMatrixSetå¯¹è±¡ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆå°±ä¸èƒ½å¦‚æ­¤å¤„ç†TileMatrixSubsetå¯¹è±¡å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºTileMatrixSetæ˜¯å¼ºåˆ¶éœ€è¦æœ‰çš„ï¼Œè€Œä¸”Geo Atlasä¸­çš„TileMatrixSetå¹¶ä¸ä¸å›¾å±‚ç»‘å®šï¼Œå£°æ˜å³æ”¯æŒï¼›è€ŒTileMatrixSubsetæ˜¯å¯é€‰çš„ï¼Œä¸”æ˜¯ç‰¹å®šäºå›¾å±‚çš„ï¼Œæ‰€ä»¥æ— æ³•å¦‚æ­¤è®¾ç½®ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">abstract</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AbstractTileSeedService</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">TileSeedService</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">TileBreeder</span><span class="w"> </span><span class="n">breeder</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">AbstractTileSeedService</span><span class="p">(</span><span class="n">TileBreeder</span><span class="w"> </span><span class="n">breeder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">breeder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">breeder</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doSeed</span><span class="p">(</span><span class="n">SeedRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">GeoAtlasCacheException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">TileMatrixSet</span><span class="w"> </span><span class="n">matrixSet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TileMatrixSetContext</span><span class="p">.</span><span class="na">getTileMatrixSet</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getMatrixSetId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">matrixSet</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GeoAtlasCacheException</span><span class="p">(</span><span class="s">&#34;TileMatrixSet not found&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">breeder</span><span class="p">.</span><span class="na">seed</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">getSubset</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">matrixSet</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * å¿…é¡»å®ç°è·å–subsetçš„æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param request
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param matrixSet
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kd">abstract</span><span class="w"> </span><span class="n">TileMatrixSubset</span><span class="w"> </span><span class="nf">getSubset</span><span class="p">(</span><span class="n">SeedRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">TileMatrixSet</span><span class="w"> </span><span class="n">matrixSet</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">GeoAtlasCacheException</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DefaultTileSeedService</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractTileSeedService</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">DefaultTileSeedService</span><span class="p">(</span><span class="n">TileBreeder</span><span class="w"> </span><span class="n">breeder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">breeder</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">TileMatrixSubset</span><span class="w"> </span><span class="nf">getSubset</span><span class="p">(</span><span class="n">SeedRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">TileMatrixSet</span><span class="w"> </span><span class="n">matrixSet</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">GeoAtlasCacheException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ç”±äºç›®å‰å¹¶ä¸å­˜åœ¨å¦‚Tile Layerçš„æ¦‚å¿µ, æ‰€ä»¥åœ¨Cacheæ¨¡å—é‡Œé¢æ— æ³•è·å–åˆ°FeatureLayerçš„TileMatrixSubset, æ‰€ä»¥è¿™é‡Œç›´æ¥è¿”å›null,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// é‚£ä¹ˆå°†ä¼šä½¿ç”¨ requestä¸­ç»™å®šçš„matrixSetId æ¥åˆ›å»º TileMatrixSubset(ä¹Ÿå°±æ˜¯æ˜¯ä¸€ä¸ªèŒƒå›´ä¸TileMatrixSetç›¸åŒçš„TileMatrixSubset)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ç»§æ‰¿æ–¹å¯ä»¥è‡ªè¡Œå®ç°è¯¥æ¥å£, ä»è€Œæ³¨å…¥FeatureLayerçš„TileMatrixSubset</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="å¿«é€Ÿé›†æˆ">å¿«é€Ÿé›†æˆ<a hidden class="anchor" aria-hidden="true" href="#å¿«é€Ÿé›†æˆ">#</a></h4>
<p>æ­¤å¤„åŸºäºSpring Bootçš„<code>AutoConfiguration</code>ç‰¹æ€§å¯¹å¤–æä¾›å¿«é€Ÿé›†æˆèƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯è¯´GACæ˜¯å…·å¤‡è‡ªåŠ¨è£…é…åŠŸèƒ½çš„ã€‚è¿™é‡Œå°†éœ€è¦è¢«è‡ªåŠ¨è£…é…çš„å†…å®¹å°è£…åˆ°ä¸€å—ï¼Œå‘½åä¸º<code>GeoAtlasCacheAutoConfiguration</code>ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°<code>spring.factories</code>é…ç½®æ–‡ä»¶ä¸­ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@ConditionalOnProperty</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;geo-atlas.cache.enabled&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">havingValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;true&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">matchIfMissing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Import</span><span class="p">(</span><span class="n">StorageBrokerRegister</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GeoAtlasCacheAutoConfiguration</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@ConditionalOnMissingBean</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SeederThreadPoolExecutor</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">SeederThreadPoolExecutor</span><span class="w"> </span><span class="nf">seederThreadPoolExecutor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SeederThreadPoolExecutor</span><span class="p">(</span><span class="n">16</span><span class="p">,</span><span class="w"> </span><span class="n">32</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@ConditionalOnMissingBean</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TileSource</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">TileSource</span><span class="w"> </span><span class="nf">tileSource</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DefaultTileSource</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@ConditionalOnMissingBean</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TileBreeder</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">TileBreeder</span><span class="w"> </span><span class="nf">tileBreeder</span><span class="p">(</span><span class="n">StorageBroker</span><span class="w"> </span><span class="n">storageBroker</span><span class="p">,</span><span class="w"> </span><span class="n">TileSource</span><span class="w"> </span><span class="n">tileSource</span><span class="p">,</span><span class="w"> </span><span class="n">SeederThreadPoolExecutor</span><span class="w"> </span><span class="n">stpe</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TileBreeder</span><span class="p">(</span><span class="n">tileSource</span><span class="p">,</span><span class="w"> </span><span class="n">storageBroker</span><span class="p">,</span><span class="w"> </span><span class="n">stpe</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@ConditionalOnMissingBean</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TileSeedService</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">TileSeedService</span><span class="w"> </span><span class="nf">tileSeedService</span><span class="p">(</span><span class="n">TileBreeder</span><span class="w"> </span><span class="n">tileBreeder</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DefaultTileSeedService</span><span class="p">(</span><span class="n">tileBreeder</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@ConditionalOnMissingBean</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TileSeedEndpoint</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">TileSeedEndpoint</span><span class="w"> </span><span class="nf">tileSeedEndpoint</span><span class="p">(</span><span class="n">TileSeedService</span><span class="w"> </span><span class="n">tileSeedService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TileSeedEndpoint</span><span class="p">(</span><span class="n">tileSeedService</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><img loading="lazy" src="https://zhou-fuyi.github.io/picx-images-hosting/gac-3.7egnskq1k6.webp" alt="gac-3"  />
</p>
<blockquote>
<p>ğŸ’¡ éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œæ­¤å¤„æ‰€è¿°çš„è‡ªåŠ¨è£…é…ï¼Œä»…ä»…åªèƒ½å®Œæˆç¼“å­˜æ¨¡å—çš„è£…é…ï¼Œå¹¶æš´éœ²å‡ºå…¨å±€å”¯ä¸€çš„<code>BlobStore</code>ä»£ç†å¯¹è±¡ï¼š<code>StorageBroker</code>ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å®Œæˆä¸å›¾å±‚æˆ–æºç«¯çš„é“¾æ¥ï¼Œéœ€è¦æ¥å…¥æ–¹è‡ªè¡Œå¤„ç†ã€‚å¯¹äºGACçš„æ¥å…¥ç¤ºä¾‹ï¼Œå¯å‚è€ƒé™„å½•éƒ¨åˆ†ã€‚</p>
</blockquote>
<h2 id="å°ç»“">å°ç»“<a hidden class="anchor" aria-hidden="true" href="#å°ç»“">#</a></h2>
<p>GACï¼Œå³Geo Atlas Cacheï¼Œè‡ªæ­¤å·²å…¨éƒ¨å®Œæˆã€‚é€šè¿‡GACå¼€å‘ï¼Œå¯¹äºGWCï¼ˆGeoWebCacheï¼‰çš„ç†è§£åˆå¤šäº†ä¸€äº›ğŸ«£ã€‚</p>
<p>äº‹åŠ¡çš„äº§ç”Ÿå¿…æœ‰å…¶åŸå› ä¸å…¶ä½¿å‘½ï¼Œå³è¦è§£å†³çš„é—®é¢˜ï¼ŒåŒæ—¶è¿˜ä¼šå—äº§ç”Ÿé˜¶æ®µçš„ç¯å¢ƒå½±å“ã€‚GACä¹‹æ‰€ä»¥å‡ºç°æ˜¯å› ä¸ºéœ€è¦æ„å»ºGeo Atlasçš„ç”Ÿæ€ï¼ŒåŒæ—¶å¸Œæœ›å¯ä»¥ä¿æŒç¼“å­˜æ¨¡å—çš„çº¯ç²¹æ€§å’Œæ˜“ç”¨æ€§ï¼Œä¸”å¯ä»¥å¿«é€Ÿè¿›è¡Œé›†æˆï¼Œä»¥ä¾¿æŠ•å…¥é¡¹ç›®å¼€å‘ä¸­ã€‚å—åˆ¶äºä¸ªäººç»å†ä¸çœ¼ç•Œçš„å½±å“ï¼ŒGACã€Geo Atlaså¹¶æ²¡æœ‰è¾¾æˆå…¶ç†æƒ³çš„çŠ¶æ€ï¼Œè™½ä¸å½±å“æ­£å¸¸çš„ä½¿ç”¨ã€‚ï¼ˆè¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªæ‚–è®ºï¼Œäººæ˜¯å¤æ‚çš„ï¼Œæˆ–è®¸æ˜¯å†¥å†¥ä¹‹ä¸­æœ‰äººå‘Šè¯‰æˆ‘ï¼Œè®©æˆ‘æœ‰äº†æ­¤æ®µæè¿°ä¹Ÿæœªå¯çŸ¥å•Š ğŸ˜‘ï¼‰</p>
<p>æˆ‘æ„¿é›†ä¼—å®¶ä¹‹æ‰€é•¿ï¼Œå¡‘äºGeo Atlasã€‚æœŸå¾…ä½ çš„è¿›æ­¥ï¼ŒåŠ æ²¹ï¼</p>
<blockquote>
<p>ğŸ’¡ psï¼šæ›´å¤šå®ç°æƒ…å†µï¼Œè¯·å‚è§GACæºç ï¼š<a href="https://github.com/geoatlas-cloud/geo-atlas/tree/main/component/tile-cache">Geo Atlas Cache@Github</a></p>
</blockquote>
<h2 id="å‚è€ƒ">å‚è€ƒ<a hidden class="anchor" aria-hidden="true" href="#å‚è€ƒ">#</a></h2>
<ul>
<li>
<p><a href="https://xie.infoq.cn/article/0c8c163899a5425dd19c7b48f">JavaäºŒçº§é«˜é€Ÿç¼“å­˜æ¶æ„è®¾è®¡_ç¼“å­˜_å…ƒå¹´æŠ€æœ¯æ´å¯Ÿ_InfoQå†™ä½œç¤¾åŒº</a></p>
</li>
<li>
<p><a href="https://www.cnblogs.com/crazymakercircle/p/17673609.html">å¤šçº§ç¼“å­˜ æ¶æ„è®¾è®¡ - ç–¯ç‹‚åˆ›å®¢åœˆ - åšå®¢å›­</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/7202479313228218428">å¾®æœåŠ¡æ¶æ„ä¸­çš„å¤šçº§ç¼“å­˜è®¾è®¡è¿˜æœ‰äººä¸æ‡‚ï¼Ÿ</a></p>
</li>
<li>
<p><a href="https://www.jiqizhixin.com/articles/2020-07-24-12">å½»åº•å¼„æ‡‚æµè§ˆå™¨ç¼“å­˜ç­–ç•¥</a></p>
</li>
<li>
<p><a href="http://support.supermap.com.cn/DataWarehouse/WebDocHelp/iServer/Subject_introduce/Cache/MapCache/TileFormat/MBTiles_Support.htm">MBTiles ä¸ SMTiles æ ¼å¼çš„åœ°å›¾ç“¦ç‰‡</a></p>
</li>
<li>
<p><a href="https://docs.geoserver.org/main/en/user/geowebcache/webadmin/blobstores.html">BlobStores â€” GeoServer 2.26.x User Manual</a></p>
</li>
<li>
<p><a href="https://geowebcache.osgeo.org/docs/current/concepts/metatiles.html">GeoWebCache Metatiles</a></p>
</li>
</ul>
<h2 id="é™„å½•">é™„å½•<a hidden class="anchor" aria-hidden="true" href="#é™„å½•">#</a></h2>
<h3 id="gacçš„é›†æˆç¤ºä¾‹">GACçš„é›†æˆç¤ºä¾‹<a hidden class="anchor" aria-hidden="true" href="#gacçš„é›†æˆç¤ºä¾‹">#</a></h3>
<p>æˆ‘åœ¨ogc-apiæ¨¡å—ä¸­é›†æˆäº†tile-cacheï¼ˆå³GACï¼‰ï¼Œä¸‹é¢å¯¹æœ¬æ¬¡é›†æˆåšç®€è¦æè¿°ï¼š</p>
<ul>
<li>
<p>ç¬¬ä¸€è¦ç´ ï¼Œä¾èµ–</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.geo-atlas.component<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>tile-cache<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>${revision}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div></li>
<li>
<p>å®ç°æºç«¯ï¼ˆData Sourceï¼‰äºGACçš„é“¾æ¥ &amp; å®ç°<code>TileSource</code>æ‹“å±•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DefaultTileGenerator</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractTileSource</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">GeoAtlasTileGenerator</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">FeatureSourceHelper</span><span class="w"> </span><span class="n">featureSourceHelper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">lockProvider</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">transient</span><span class="w"> </span><span class="n">LockProvider</span><span class="w"> </span><span class="n">lockProviderInstance</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">DefaultTileGenerator</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">DefaultTileGenerator</span><span class="p">(</span><span class="n">FeatureSourceHelper</span><span class="w"> </span><span class="n">featureSourceHelper</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">featureSourceHelper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">featureSourceHelper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ConveyorTile</span><span class="w"> </span><span class="nf">generator</span><span class="p">(</span><span class="n">ConveyorTile</span><span class="w"> </span><span class="n">tile</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="p">,</span><span class="w"> </span><span class="n">GeoAtlasCacheException</span><span class="p">,</span><span class="w"> </span><span class="n">OutsideCoverageException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// FIXME: 2024/5/10 å¯ä»¥å†æ¬¡æ£€æŸ¥ MimeType, åœ¨åº”ç”¨å±‚é¢æ§åˆ¶MimeTypeçš„æ”¯æŒ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// checkMimeType(tile);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">TileMatrixSet</span><span class="w"> </span><span class="n">tileMatrixSet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TileMatrixSetContext</span><span class="p">.</span><span class="na">getTileMatrixSet</span><span class="p">(</span><span class="n">tile</span><span class="p">.</span><span class="na">getGridSetId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tileMatrixSet</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&#34;TileMatrixSet not found by identifier: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tile</span><span class="p">.</span><span class="na">getGridSetId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// FIXME: 2024/5/10 éœ€è¦åœ¨metadataä¸­ç»™featureLayeræŒ‡å®šcoverage, å¯ä»¥é€‰æ‹©ä»æ•°æ®æºè¯»å–æˆ–è€…æ˜¯è‡ªè¡Œè®¾å®š(æ›´æ¨èè‡ªè¡Œè®¾å®š, æ€§èƒ½å‹å¥½ä¸”æ›´é€šç”¨)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">TileMatrixSubset</span><span class="w"> </span><span class="n">gridSubset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tile</span><span class="p">.</span><span class="na">getGridSubset</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gridSubset</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&#34;Requested gridset not found: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tile</span><span class="p">.</span><span class="na">getRequest</span><span class="p">().</span><span class="na">getSchema</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="o">[]</span><span class="w"> </span><span class="n">gridLoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tile</span><span class="p">.</span><span class="na">getTileIndex</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">checkNotNull</span><span class="p">(</span><span class="n">gridLoc</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Final preflight check, throws OutsideCoverageException if necessary</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">gridSubset</span><span class="p">.</span><span class="na">checkCoverage</span><span class="p">(</span><span class="n">gridLoc</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// FIXME: 2024/5/10 æš‚æ—¶ä¸å¯¹meta tilesåšæ”¯æŒ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">metaX</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">metaY</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tile</span><span class="p">.</span><span class="na">getMimeType</span><span class="p">().</span><span class="na">supportsTiling</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">metaX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getMetaTilingFactors</span><span class="p">()</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">metaY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getMetaTilingFactors</span><span class="p">()</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">metaX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">metaY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ConveyorTile</span><span class="w"> </span><span class="n">tileResponse</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tile</span><span class="p">.</span><span class="na">getStorageBroker</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">tileResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getNonCachedTile</span><span class="p">(</span><span class="n">tile</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">tileResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getTileResponse</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">metaX</span><span class="p">,</span><span class="w"> </span><span class="n">metaY</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//        sendTileRequestedEvent(returnTile);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">tileResponse</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ConveyorTile</span><span class="w"> </span><span class="nf">getNonCachedTile</span><span class="p">(</span><span class="n">ConveyorTile</span><span class="w"> </span><span class="n">tile</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">GeoAtlasCacheException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">getTileResponse</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="n">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GeoAtlasCacheException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">seedTile</span><span class="p">(</span><span class="n">ConveyorTile</span><span class="w"> </span><span class="n">tile</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">tryCache</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">GeoAtlasCacheException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Ignore a seed call on a tile that&#39;s outside the cached grid levels range</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// å¿½ç•¥ç¼“å­˜ç½‘æ ¼çº§åˆ«èŒƒå›´ä¹‹å¤–çš„å›¾å—ä¸Šçš„ç§å­è°ƒç”¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">TileMatrixSubset</span><span class="w"> </span><span class="n">subset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tile</span><span class="p">.</span><span class="na">getGridSubset</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">zLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">tile</span><span class="p">.</span><span class="na">getTileIndex</span><span class="p">()</span><span class="o">[</span><span class="n">2</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">subset</span><span class="p">.</span><span class="na">shouldCacheAtZoom</span><span class="p">(</span><span class="n">zLevel</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">log</span><span class="p">.</span><span class="na">isDebugEnabled</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">log</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="s">&#34;Ignoring seed call on tile &#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="o">+</span><span class="w"> </span><span class="n">tile</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; as it&#39;s outside the cacheable zoom level range&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">metaX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getMetaTilingFactors</span><span class="p">()</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">metaY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getMetaTilingFactors</span><span class="p">()</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">tile</span><span class="p">.</span><span class="na">getMimeType</span><span class="p">().</span><span class="na">supportsTiling</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">metaX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">metaY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">getTileResponse</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span><span class="w"> </span><span class="n">tryCache</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">metaX</span><span class="p">,</span><span class="w"> </span><span class="n">metaY</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">ConveyorTile</span><span class="w"> </span><span class="nf">getTileResponse</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">ConveyorTile</span><span class="w"> </span><span class="n">tile</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">tryCache</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">persistent</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">metaX</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">metaY</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">throws</span><span class="w"> </span><span class="n">GeoAtlasCacheException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tryCache</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">tryCacheFetch</span><span class="p">(</span><span class="n">tile</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">finalizeTile</span><span class="p">(</span><span class="n">tile</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">TileObject</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">TileRequest</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tile</span><span class="p">.</span><span class="na">getRequest</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">LockProvider</span><span class="p">.</span><span class="na">Lock</span><span class="w"> </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="cm">/* ****************** Acquire lock ******************* */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getLockProvider</span><span class="p">().</span><span class="na">getLock</span><span class="p">(</span><span class="n">buildLockKey</span><span class="p">(</span><span class="n">tile</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// got the lock on the tile, try again</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tryCache</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">tryCacheFetch</span><span class="p">(</span><span class="n">tile</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">log</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&#34;--&gt; {} returns cache hit for {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">(),</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="n">tile</span><span class="p">.</span><span class="na">getTileIndex</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">log</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&#34;--&gt; {} submitting getTile request for tile matrix location on {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">(),</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="n">tile</span><span class="p">.</span><span class="na">getTileIndex</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kt">long</span><span class="w"> </span><span class="n">requestTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">FeatureSourceConveyor</span><span class="w"> </span><span class="n">wrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">featureSourceHelper</span><span class="p">.</span><span class="na">getFeatureSource</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getNamespace</span><span class="p">(),</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getLayer</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">Pyramid</span><span class="w"> </span><span class="n">pyramid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findPyramid</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">wrapper</span><span class="p">.</span><span class="na">getRules</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pyramid</span><span class="p">.</span><span class="na">getTile</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">wrapper</span><span class="p">.</span><span class="na">getFeatureSource</span><span class="p">(),</span><span class="w"> </span><span class="n">wrapper</span><span class="p">.</span><span class="na">getCrs</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="c1">// æ­¤å¤„ä¾¿å®Œæˆäº†ç“¦ç‰‡æ•°æ®å¯¹è±¡åˆ°ç“¦ç‰‡ç¼“å­˜çš„è½¬æ¢</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">transferTile</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="n">tile</span><span class="p">,</span><span class="w"> </span><span class="n">requestTime</span><span class="p">,</span><span class="w"> </span><span class="n">persistent</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">Throwables</span><span class="p">.</span><span class="na">throwIfInstanceOf</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">GeoAtlasCacheException</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GeoAtlasCacheException</span><span class="p">(</span><span class="s">&#34;Problem communicating with GeoAtlas TileAPI&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lock</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">lock</span><span class="p">.</span><span class="na">release</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">finalizeTile</span><span class="p">(</span><span class="n">tile</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p>å®ç°TileMatrixSubsetæ‹“å±•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@ConditionalOnBean</span><span class="p">(</span><span class="n">TileBreeder</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SimpleTileSeedService</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractTileSeedService</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">FeatureTileMatrixSubsetContext</span><span class="w"> </span><span class="n">subsetContext</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">FeatureSourceHelper</span><span class="w"> </span><span class="n">featureSourceHelper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">SimpleTileSeedService</span><span class="p">(</span><span class="n">TileBreeder</span><span class="w"> </span><span class="n">breeder</span><span class="p">,</span><span class="w"> </span><span class="n">FeatureTileMatrixSubsetContext</span><span class="w"> </span><span class="n">subsetContext</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                 </span><span class="n">FeatureSourceHelper</span><span class="w"> </span><span class="n">featureSourceHelper</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">breeder</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">subsetContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subsetContext</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">featureSourceHelper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">featureSourceHelper</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">TileMatrixSubset</span><span class="w"> </span><span class="nf">getSubset</span><span class="p">(</span><span class="n">SeedRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">TileMatrixSet</span><span class="w"> </span><span class="n">matrixSet</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">GeoAtlasCacheException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">NamespaceInfo</span><span class="w"> </span><span class="n">namespaceInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">featureSourceHelper</span><span class="p">.</span><span class="na">getNamespaceInfo</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getNamespace</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">namespaceInfo</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GeoAtlasCacheException</span><span class="p">(</span><span class="s">&#34;namespace not found&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">FeatureLayerInfo</span><span class="w"> </span><span class="n">featureLayerInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">featureSourceHelper</span><span class="p">.</span><span class="na">getFeatureLayerInfo</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getNamespace</span><span class="p">(),</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getLayerName</span><span class="p">(),</span><span class="w"> </span><span class="n">namespaceInfo</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">featureLayerInfo</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GeoAtlasCacheException</span><span class="p">(</span><span class="s">&#34;layer not found&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">subsetContext</span><span class="p">.</span><span class="na">getTileMatrixSubset</span><span class="p">(</span><span class="n">featureLayerInfo</span><span class="p">,</span><span class="w"> </span><span class="n">matrixSet</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p>ç¼“å­˜é…ç½®ï¼ˆæ­¤é…ç½®æ¥è‡ªäºï¼š<a href="https://github.com/geoatlas-cloud/geo-atlas/blob/main/app/geoatlas-tile-instance/src/main/resources/application-dev.yml">geoatlas-tile-instance</a>ï¼‰ï¼Œå¹¶æœªå±•ç¤ºå‡ºå…¨éƒ¨é…ç½®å†…å®¹</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">geo-atlas</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cache</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">inner-caching-enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">persistence-enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="c"># é»˜è®¤æ˜¯file-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">inner</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">eviction-policy</span><span class="p">:</span><span class="w"> </span><span class="l">EXPIRE_AFTER_ACCESS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">memory-limit</span><span class="p">:</span><span class="w"> </span><span class="m">256</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">persistence</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">base-directory</span><span class="p">:</span><span class="w"> </span><span class="l">${PERSISTENCE_CACHE_DIR:/tmp/gac}</span><span class="w">
</span></span></span></code></pre></div></li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://fuyi-atlas.github.io/tags/geo-atlas-cache/">Geo Atlas Cache</a></li>
      <li><a href="https://fuyi-atlas.github.io/tags/tile-cache/">Tile Cache</a></li>
      <li><a href="https://fuyi-atlas.github.io/tags/gac/">Gac</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="https://fuyi-atlas.github.io/posts/gis/what-is-tilematrixset-calculation-principle/">
    <span class="title">Next Â»</span>
    <br>
    <span>å†è°ˆTileMatrixSetï¼ŒäºŒç»´ç“¦ç‰‡é‡‘å­—å¡”ç»“æ„çš„æ ‡å‡†å®šä¹‰ï¼ˆä¸‹ï¼‰</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://fuyi-atlas.github.io/">Fuyi Atlas</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
